

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial of pydefect &mdash; pydefect  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tips for first-principles calculations for point defects" href="first_principles_calc.html" />
    <link rel="prev" title="Welcome to pydefect documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> pydefect
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial of pydefect</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#relaxation-of-the-unit-cell">1. Relaxation of the unit cell</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calculation-of-band-dos-and-dielectric-tensor">2. Calculation of band, DOS, and dielectric tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gathering-unitcell-information-related-to-point-defect-calculations">3. Gathering unitcell information related to point-defect calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calculation-of-competing-phases">4. Calculation of competing phases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#construction-of-a-supercell-and-defect-species">5. Construction of a supercell and defect species</a></li>
<li class="toctree-l2"><a class="reference internal" href="#decision-of-interstitial-sites">6. Decision of interstitial sites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creation-of-defect-calculation-directories">7. Creation of defect calculation directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generation-of-defect-entry-json">8. Generation of defect_entry.json</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing-supercell-calculation-results">9. Parsing supercell calculation results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#corrections-of-defect-formation-energies-in-finite-size-supercells">10. Corrections of defect formation energies in finite-size supercells</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-defect-structures">11. Check defect structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations">12. Check defect eigenvalues and band-edge states in supercell calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-defect-formation-energies">13. Plot defect formation energies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="first_principles_calc.html">Tips for first-principles calculations for point defects</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_transition_level.html">Tutorial for calculation of vertical transition level</a></li>
<li class="toctree-l1"><a class="reference internal" href="change_log.html">Change log</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pydefect</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tutorial of pydefect</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-of-pydefect">
<h1>Tutorial of pydefect<a class="headerlink" href="#tutorial-of-pydefect" title="Permalink to this headline">¶</a></h1>
<p>This page illustrates how to use the <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> code.</p>
<p><strong>Note1: Pydefect now supports only the vienna ab-initio simulation package (VASP),
so we suppose its input and output file names (e.g., POSCAR, POTCAR, OUTCAR),
and computational techniques (e.g., periodic boundary condition) used in VASP.</strong></p>
<p><strong>Note2: Units used in pydefect are eV for energy and Angstrom for length
following the vasp convention.</strong></p>
<p><strong>Note3: Only nonmagnetic host materials are supposed for now.</strong></p>
<p>Workflow of a point-defect calculation in a non-metallic solid is shown below.
One can see some tasks are performed concurrently, while others must follow some tasks.
Usually, the processes are intricate and time consuming and researchers are prone to make mistakes.
The main purpose of <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> is to provide the researchers
with the automation system for the point-defect calculations in non-metallic materials
so that they save time and reduce human errors.</p>
<img alt="_images/pydefect.png" src="_images/pydefect.png" />
<p>This cheat sheet is divided into three parts, namely unitcell, cpd, and defect,
which correspond to the working directories as shown below.
The red texts indicate the related commands, while blue ones the files created with these commands.
The branching steps provide for two options.
The filled rectangles with blue color require the VASP calculations,
while the bolded ones associate multiple directories related to defects considered.
The green rectangle steps are not essential.</p>
<p>Here, we suppose the following directory tree.
The <code class="code docutils literal notranslate"><span class="pre">&lt;project_name&gt;</span></code> is usually the target material name with the
crystal structure if needed, e.g., rutile-TiO<sub>2</sub>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;project_name&gt;
 │
 ├ pydefect.yaml
 ├ vise.yaml
 │
 ├ unitcell/ ── structure_opt/
 │            ├ band/
 │            ├ dielectric/
 │            └ dos/
 │
 ├ cpd/ ──── &lt;competing_phase 1&gt;
 │       ├── &lt;competing_phase 2&gt;
 │           ....
 │
 └ defect/ ── perfect/
            ├─ Va_X_0/
            ├─ Va_X_1/
            ├─ Va_X_2/
             ...
</pre></div>
</div>
<p>We recommend the users to follow the same directory structure if possible.
Details of the processes are examined step by step
with an example of MgAl2O4 calculated using the PBEsol functional.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, there are five main commands, namely
<code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, <code class="code docutils literal notranslate"><span class="pre">pydefect_vasp</span></code>, <code class="code docutils literal notranslate"><span class="pre">pydefect_util</span></code>,
<code class="code docutils literal notranslate"><span class="pre">pydefect_vasp_util</span></code>, and <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code>.
<code class="code docutils literal notranslate"><span class="pre">Pydefect_vasp</span></code> and <code class="code docutils literal notranslate"><span class="pre">pydefect_vasp_util</span></code> are related to the VASP,
while <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> and <code class="code docutils literal notranslate"><span class="pre">pydefect_util</span></code> are independent of the DFT code.
Those consisting of a suffix, <code class="code docutils literal notranslate"><span class="pre">_util</span></code>, are not essentially needed but are useful in some cases.</p>
<p>There are also many arguments for each sub-command.
One can always refer its help with the <code class="code docutils literal notranslate"><span class="pre">-h</span></code> argument, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>for details.</p>
<div class="section" id="relaxation-of-the-unit-cell">
<h2>1. Relaxation of the unit cell<a class="headerlink" href="#relaxation-of-the-unit-cell" title="Permalink to this headline">¶</a></h2>
<p>The point-defect calculations are generally performed at the theoretically relaxed
structure under the given functional and projector augmented wave (PAW) potentials,
as it is free from artificial strain and stress
that is responsible for the unwanted supercell size dependency.
Therefore, one usually begins with optimizing lattice constants
and fractional coordinates of the atomic positions in the unitcell.</p>
<p>We first prepare <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> of the pristine bulk unitcell,
and create <code class="code docutils literal notranslate"><span class="pre">unitcell/</span></code> directory and <code class="code docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code>
sub-directory ( <code class="code docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">unitcell/structure_opt/</span></code>) and move there.
(In this tutorial, the name with <code class="code docutils literal notranslate"><span class="pre">/</span></code> at the end means a directory.)
When <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> needs to construct the vasp input files,
namely <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">POTCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code> files,
we use <a class="reference external" href="https://kumagai-group.github.io/vise/">vise</a>
(= <code class="code docutils literal notranslate"><span class="pre">vasp</span> <span class="pre">integrated</span> <span class="pre">supporting</span> <span class="pre">environment</span></code>) code,
which generates the input files for various tasks and exchange-correlation (XC) functionals.
<code class="code docutils literal notranslate"><span class="pre">Vise</span></code> relies on the <a class="reference external" href="http://pymatgen.org">pymatgen</a>, and
therefore, as shown <a class="reference external" href="https://pymatgen.org/usage.html">pymatgen web page 1</a> or
<a class="reference external" href="https://pymatgen.org/_modules/pymatgen/io/vasp/inputs.html">2</a>,
we need to set the <code class="code docutils literal notranslate"><span class="pre">PMG_DEFAULT_FUNCTIONAL</span></code> and <code class="code docutils literal notranslate"><span class="pre">PMG_VASP_PSP_DIR</span></code>
in the <code class="code docutils literal notranslate"><span class="pre">.pmgrc.yaml</span></code> file at the home directory, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMG_DEFAULT_FUNCTIONAL</span><span class="p">:</span> <span class="n">PBE_54</span>
<span class="n">PMG_MAPI_KEY</span><span class="p">:</span> <span class="n">xxxxxxxxxxxxxxxx</span>
<span class="n">PMG_VASP_PSP_DIR</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">kumagai</span><span class="o">/</span><span class="n">potcars</span><span class="o">/</span>
</pre></div>
</div>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, <code class="code docutils literal notranslate"><span class="pre">PMG_MAPI_KEY</span></code> is required for querying
<code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> files and total energies for competing materials.</p>
<p>Input files for optimizing a unitcell using the PBEsol functional
are generated by the following command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vasp_set</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span>
</pre></div>
</div>
<p>where <code class="code docutils literal notranslate"><span class="pre">vasp_set</span></code>, or its abbreviation <code class="code docutils literal notranslate"><span class="pre">vs</span></code>,
is a sub-command option of the <code class="code docutils literal notranslate"><span class="pre">vise</span></code> main function.
Similarly, all the sub-commands have their own abbreviations
in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> and <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.
Here, the PBE functional is a default in <code class="code docutils literal notranslate"><span class="pre">vise</span></code>,
so we use the <code class="code docutils literal notranslate"><span class="pre">-x</span></code> argument to switch the XC functional to PBEsol.</p>
<p>Note that the structure optimization must be generally iterated with 1.3 times larger
cutoff energy until the forces and stresses are converged at the first ionic step.
See, <a class="reference external" href="https://www.vasp.at/wiki/index.php/Energy_vs_volume_Volume_relaxations_and_Pulay_stress">vasp manual</a>
for details.
Such iteration of the vasp calculations is not supported by <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>,
but one can easily write the simple runshell script to do so.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, users can control various default parameters as <code class="code docutils literal notranslate"><span class="pre">vise.yaml</span></code> file in <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.
See the <a class="reference external" href="https://kumagai-group.github.io/vise/">document of vise</a> for details.
The controllable parameters are shown in <code class="code docutils literal notranslate"><span class="pre">defaults.py</span></code> in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>.</p>
</div>
<div class="section" id="calculation-of-band-dos-and-dielectric-tensor">
<h2>2. Calculation of band, DOS, and dielectric tensor<a class="headerlink" href="#calculation-of-band-dos-and-dielectric-tensor" title="Permalink to this headline">¶</a></h2>
<p>We then calculate the band structure (BS), density of states (DOS), and dielectric constants.
In the defect calculations, the BS is used for determining
the valence band maximum (VBM) and conduction band minimum (CBM),
while the dielectric constant, or a sum of electronic (or ion-clamped) and ionic dielectric tensors,
is needed for correcting the defect formation energies.</p>
<p>First, we create <code class="code docutils literal notranslate"><span class="pre">band/</span></code>, <code class="code docutils literal notranslate"><span class="pre">dos/</span></code> and <code class="code docutils literal notranslate"><span class="pre">dielectric/</span></code> in <code class="code docutils literal notranslate"><span class="pre">unitcell/</span></code>
and copy <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> from <code class="code docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code>
and type the following command in each directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="n">t</span> <span class="n">band</span> <span class="o">-</span><span class="n">d</span> <span class="o">../</span><span class="n">structure_opt</span>
<span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="n">t</span> <span class="n">dos</span> <span class="o">-</span><span class="n">d</span> <span class="o">../</span><span class="n">structure_opt</span> <span class="o">-</span><span class="n">uis</span> <span class="n">LVTOT</span> <span class="kc">True</span> <span class="n">LAECHG</span> <span class="kc">True</span> <span class="n">KPAR</span> <span class="mi">1</span>
<span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="n">t</span> <span class="n">dielectric_dfpt</span> <span class="o">-</span><span class="n">d</span> <span class="o">../</span><span class="n">structure_opt</span>
</pre></div>
</div>
<p>The additional user_incar_settings (=uis) in the <code class="code docutils literal notranslate"><span class="pre">dos</span></code> directory are for creating volumetric
data of electrostatic potential and all electron charge density.</p>
<p><code class="code docutils literal notranslate"><span class="pre">Vise</span></code> also provides the plotters for the BS and DOS.
See the <a class="reference external" href="https://kumagai-group.github.io/vise/">document of vise</a> for details.</p>
</div>
<div class="section" id="gathering-unitcell-information-related-to-point-defect-calculations">
<h2>3. Gathering unitcell information related to point-defect calculations<a class="headerlink" href="#gathering-unitcell-information-related-to-point-defect-calculations" title="Permalink to this headline">¶</a></h2>
<p>We next collect the bulk information,
namely the band edges and electronic and ionic dielectric tensors
using the <code class="code docutils literal notranslate"><span class="pre">unitcell</span></code> (= <code class="code docutils literal notranslate"><span class="pre">u</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">u</span> <span class="o">-</span><span class="n">vb</span> <span class="n">band</span><span class="o">/</span><span class="n">vasprun</span><span class="o">-</span><span class="n">finish</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">ob</span> <span class="n">band</span><span class="o">/</span><span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">odc</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">odi</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">n</span> <span class="n">MgAl2O4</span>
</pre></div>
</div>
<p>Here, the electronic and ionic dielectric constants can be set
with different <code class="code docutils literal notranslate"><span class="pre">OUTCAR</span></code> files.
Then, <code class="code docutils literal notranslate"><span class="pre">unitcell.yaml</span></code> is generated, which will be used for analyzing defect calculations later.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="p">:</span> <span class="n">MgAl2O4</span>
<span class="n">vbm</span><span class="p">:</span> <span class="mf">4.0183</span>
<span class="n">cbm</span><span class="p">:</span> <span class="mf">9.2376</span>
<span class="n">ele_dielectric_const</span><span class="p">:</span>
<span class="o">-</span> <span class="o">-</span> <span class="mf">3.075988</span>
  <span class="o">-</span> <span class="mf">0.0</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">3.075988</span>
  <span class="o">-</span> <span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">3.075988</span>
<span class="n">ion_dielectric_const</span><span class="p">:</span>
<span class="o">-</span> <span class="o">-</span> <span class="mf">5.042937</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">5.042937</span>
  <span class="o">-</span> <span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">5.042937</span>
</pre></div>
</div>
<p>Of course, the users can also create it by hand.</p>
</div>
<div class="section" id="calculation-of-competing-phases">
<h2>4. Calculation of competing phases<a class="headerlink" href="#calculation-of-competing-phases" title="Permalink to this headline">¶</a></h2>
<p>When a defect is introduced, atoms are exchanged with the hypothetical atomic
reservoirs within the thermodynamics framework.
To calculate a free energy of defect formation that is approximated
with the defect formation energy in most cases,
we need to determine atom’s chemical potentials associated with defects.
Usually, we consider the chemical potentials at the condition
where competing phases coexist with the host material,
which are determined from the chemical potential diagram (CPD).</p>
<p>For this purpose, we create directories in <code class="code docutils literal notranslate"><span class="pre">cpd/</span></code>.
We can retrieve POSCARs of the stable or slightly unstable competing phases
from <a class="reference external" href="https://materialsproject.org">the Materials Project database (MPD)</a>.
For this purpose, one needs <a class="reference external" href="https://materialsproject.org/open">the API keys</a>
of the MP as mentioned above.
We obtain the competing materials with MgAl2O4 whose energies above hull are less than 0.5 meV/atom using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">mp</span> <span class="o">-</span><span class="n">e</span> <span class="n">Mg</span> <span class="n">Al</span> <span class="n">O</span> <span class="o">--</span><span class="n">e_above_hull</span> <span class="mf">0.0005</span>
</pre></div>
</div>
<p>This command creates the following directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Al2O3_mp</span><span class="o">-</span><span class="mi">1143</span><span class="o">/</span>  <span class="n">Al_mp</span><span class="o">-</span><span class="mi">134</span><span class="o">/</span>  <span class="n">Mg149Al_mp</span><span class="o">-</span><span class="mi">1185596</span><span class="o">/</span>  <span class="n">Mg17Al12_mp</span><span class="o">-</span><span class="mi">2151</span><span class="o">/</span>  <span class="n">MgAl2O4_mp</span><span class="o">-</span><span class="mi">3536</span><span class="o">/</span>  <span class="n">MgAl2_mp</span><span class="o">-</span><span class="mi">1094116</span><span class="o">/</span>  <span class="n">MgO_mp</span><span class="o">-</span><span class="mi">1265</span><span class="o">/</span>  <span class="n">Mg_mp</span><span class="o">-</span><span class="mi">1056702</span><span class="o">/</span>  <span class="n">mol_O2</span><span class="o">/</span>
</pre></div>
</div>
<p>We here remove <code class="code docutils literal notranslate"><span class="pre">Mg149Al_mp-1185596/</span></code> to reduce computational time in this tutorial.
In each directory, there are <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> and <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>.
The <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code> contains some information retrieved from the MPD,
which is useful for determining the conditions for the first-principles calculations via <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.</p>
<p>For example, <code class="code docutils literal notranslate"><span class="pre">Mg_mp-1056702/prior_info.yaml</span></code> is shown as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">band_gap</span><span class="p">:</span> <span class="mf">0.0</span>
<span class="n">data_source</span><span class="p">:</span> <span class="n">mp</span><span class="o">-</span><span class="mi">1056702</span>
<span class="n">total_magnetization</span><span class="p">:</span> <span class="mf">0.0007357</span>
</pre></div>
</div>
<p>which means Mg is a non-magnetic metallic system.
<code class="code docutils literal notranslate"><span class="pre">Vise</span></code> parses the <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>
and determines the k-point density in <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code>
and spin polarization via <code class="code docutils literal notranslate"><span class="pre">ISPIN</span></code> tag in <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>.
If the retrieved values are obviously incorrect, the user may change the values by hand.</p>
<p>O<sub>2</sub>, H<sub>2</sub>, N<sub>2</sub>, NH<sub>3</sub>, and NO<sub>2</sub> molecules
are not retrieved from the MPD but created by <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> itself,
since these compositions have been calculated as solids in the MPD,
which could be inadequate for competing phases for the defect calculations.</p>
<p>We then generate <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">POTCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code> files for these.
We need to use the <strong>common cutoff energy</strong>, <code class="code docutils literal notranslate"><span class="pre">ENCUT</span></code>, for comparing the total energies,
which is increased to 1.3 times of <strong>max</strong> <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code> between the constituent POTCARs.
In case of MgAl2O4, <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code> of Mg, Al, and O are 200.0, 240.3 and 400.0 eV,
so we need to set <code class="code docutils literal notranslate"><span class="pre">ENCUT</span> <span class="pre">=</span> <span class="pre">520.0</span></code>, using the <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in *_*/;do cd $i; vise vs -uis ENCUT 520.0 -x pbesol ; cd ../;done
</pre></div>
</div>
<p>The target material, namely MgAl2O4 in this example, has already been calculated in the same condition,
so we do not have to iterate the same calculation;
instead make a symbolic link by <code class="code docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">../unitcell/structure_opt</span> <span class="pre">MgAl2O4</span></code>
and remove the <code class="code docutils literal notranslate"><span class="pre">MgAl2O4_mp-3536/</span></code> directory.
However, we need to calculate it, when we adopt different <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code>
to keep consistency with larger <code class="code docutils literal notranslate"><span class="pre">ENMAX</span></code> for dopant atoms.</p>
<p>Note also that, if competing phases are gases, we need to change
<code class="code docutils literal notranslate"><span class="pre">ISIF</span></code> to 2 so as not to relax the lattice constants
(see <a class="reference external" href="https://cms.mpi.univie.ac.at/wiki/index.php/ISIF">[vasp manual]</a>),
and <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code> to the Gamma-point-only sampling.
This is, however, automatically tuned with <code class="code docutils literal notranslate"><span class="pre">vise</span></code> via <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>.</p>
<p>After finishing the vasp calculations,
we can generate the <code class="code docutils literal notranslate"><span class="pre">composition_energies.yaml</span></code> file,
which collects the total energies per calculated formula
using the <code class="code docutils literal notranslate"><span class="pre">make_composition_energies</span></code> (= <code class="code docutils literal notranslate"><span class="pre">mce</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">mce</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>When renaming the <code class="code docutils literal notranslate"><span class="pre">vasprun.xml</span></code> and <code class="code docutils literal notranslate"><span class="pre">OUTCAR</span></code> files to e.g.,
<code class="code docutils literal notranslate"><span class="pre">vasprun-finish.xml</span></code> and <code class="code docutils literal notranslate"><span class="pre">OUTCAR-finish</span></code> during the calculations,
one needs to write the following lines in the <code class="code docutils literal notranslate"><span class="pre">vise.yaml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># VASP file names</span>
<span class="n">outcar</span><span class="p">:</span> <span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span>
<span class="n">vasprun</span><span class="p">:</span> <span class="n">vasprun</span><span class="o">-</span><span class="n">finish</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://kumagai-group.github.io/vise/tutorial_vise_yaml.html">Tutorial for vise.yaml</a>.</p>
<p>We next create <code class="code docutils literal notranslate"><span class="pre">relative_energies.yaml</span></code> and <code class="code docutils literal notranslate"><span class="pre">standard_energies.yaml</span></code>
with the <code class="code docutils literal notranslate"><span class="pre">standard_and_relative_energies</span></code> (= <code class="code docutils literal notranslate"><span class="pre">sre</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">sre</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">standard_energies.yaml</span></code> file collects the absolute energies under the standard states as shown.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Al</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.08372115</span>
<span class="n">Mg</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.70955951</span>
<span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.139183685</span>
</pre></div>
</div>
<p>while <code class="code docutils literal notranslate"><span class="pre">relative_energies.yaml</span></code> includes the relative energies with respect to the standard states.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Al2O3</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.149440234</span>
<span class="n">Mg17Al12</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.02717980137931031</span>
<span class="n">MgAl2</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.015118513333333805</span>
<span class="n">MgAl2O4</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.097731276428572</span>
<span class="n">MgO</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.8318186275</span>
</pre></div>
</div>
<p>We then make information on the CPD using the <code class="code docutils literal notranslate"><span class="pre">cpd_and_vertices</span></code> sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cv</span> <span class="o">-</span><span class="n">t</span> <span class="n">MgAl2O4</span>
</pre></div>
</div>
<p>To plot the diagram, use the <code class="code docutils literal notranslate"><span class="pre">plot_cpd</span></code> (= <code class="code docutils literal notranslate"><span class="pre">pc</span></code>) sub-command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pc</span>
</pre></div>
</div>
<p>which also save the diagram as <code class="code docutils literal notranslate"><span class="pre">cpd.pdf</span></code>.
The binary and ternary CPDs look like</p>
<img alt="_images/cpd_MgO.png" src="_images/cpd_MgO.png" />
<img alt="_images/cpd_MgAl2O4.png" src="_images/cpd_MgAl2O4.png" />
<p>Here, the vertices surrounding the target compounds are also shown as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">target</span><span class="p">:</span> <span class="n">MgAl2O4</span>
<span class="n">A</span><span class="p">:</span>
  <span class="n">chem_pot</span><span class="p">:</span>
    <span class="n">Al</span><span class="p">:</span> <span class="mf">0.0</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.68785</span>
    <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.24907</span>
  <span class="n">competing_phases</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">Al2O3</span>
  <span class="o">-</span> <span class="n">Al</span>
  <span class="n">impurity_phases</span><span class="p">:</span> <span class="p">[]</span>
<span class="n">B</span><span class="p">:</span>
  <span class="n">chem_pot</span><span class="p">:</span>
    <span class="n">Al</span><span class="p">:</span> <span class="mf">0.0</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.32348</span>
    <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.34016</span>
  <span class="n">competing_phases</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">MgO</span>
  <span class="o">-</span> <span class="n">Al</span>
  <span class="n">impurity_phases</span><span class="p">:</span> <span class="p">[]</span>
<span class="n">C</span><span class="p">:</span>
  <span class="n">chem_pot</span><span class="p">:</span>
    <span class="n">Al</span><span class="p">:</span> <span class="o">-</span><span class="mf">7.8736</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.93692</span>
    <span class="n">O</span><span class="p">:</span> <span class="mf">0.0</span>
  <span class="n">competing_phases</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">Al2O3</span>
  <span class="o">-</span> <span class="n">O</span>
  <span class="n">impurity_phases</span><span class="p">:</span> <span class="p">[]</span>
<span class="n">D</span><span class="p">:</span>
  <span class="n">chem_pot</span><span class="p">:</span>
    <span class="n">Al</span><span class="p">:</span> <span class="o">-</span><span class="mf">8.01024</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.66364</span>
    <span class="n">O</span><span class="p">:</span> <span class="mf">0.0</span>
  <span class="n">competing_phases</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">MgO</span>
  <span class="o">-</span> <span class="n">O</span>
  <span class="n">impurity_phases</span><span class="p">:</span> <span class="p">[]</span>
</pre></div>
</div>
<p>If one needs to modify the energies for the CPD,
one can directly modify the <code class="code docutils literal notranslate"><span class="pre">relative_energies.yaml</span></code> file.</p>
<p>Calculations of the competing phases are often laborious,
and sometimes we want to check the defect formation energies sooner.
<code class="code docutils literal notranslate"><span class="pre">Pydefect</span></code> supports to create the CPD based on the MPD.
To do this, one firstly prepare atom energies that are needed for aligning the energy standards.</p>
<p>With <code class="code docutils literal notranslate"><span class="pre">vise</span></code>, we can easily prepare atom calculation directories.
Here, we show an example of MgAl2O4:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise_util</span> <span class="nb">map</span> <span class="o">-</span><span class="n">e</span> <span class="n">Mg</span> <span class="n">Al</span> <span class="n">O</span>
</pre></div>
</div>
<p>Then, create the vasp input files</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in */;do cd $i; vise vs ; cd ../;done
</pre></div>
</div>
<p>and run the vasp.
The atom energies are collected to yaml file format using the following python script.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymatgen.core</span> <span class="kn">import</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp</span> <span class="kn">import</span> <span class="n">Outcar</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Element</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/OUTCAR-finish&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;3</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">final_energy</span><span class="si">:</span><span class="s2">11.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Assuming the output is saved to <code class="code docutils literal notranslate"><span class="pre">atom_energies.yaml</span></code>,
the <code class="code docutils literal notranslate"><span class="pre">composition_energies.yaml</span></code> file is generated using the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_util</span> <span class="n">cefm</span> <span class="o">-</span><span class="n">a</span> <span class="n">atom_energies</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">e</span> <span class="n">Mg</span> <span class="n">Al</span> <span class="n">O</span>
</pre></div>
</div>
<p>Once <code class="code docutils literal notranslate"><span class="pre">composition_energies.yaml</span></code> is obtained, the following steps are the same as above.</p>
</div>
<div class="section" id="construction-of-a-supercell-and-defect-species">
<h2>5. Construction of a supercell and defect species<a class="headerlink" href="#construction-of-a-supercell-and-defect-species" title="Permalink to this headline">¶</a></h2>
<p>We have finished the calculations of the unit cell and CPD,
and now are ready for the point-defect calculations.
Let’s create the <code class="code docutils literal notranslate"><span class="pre">defect/</span></code> directory.</p>
<p>We then create files related to a supercell and defect species with
the <code class="code docutils literal notranslate"><span class="pre">supercell</span></code> (= <code class="code docutils literal notranslate"><span class="pre">s</span></code>) and <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> (= <code class="code docutils literal notranslate"><span class="pre">ds</span></code>) sub-commands.</p>
<p><code class="code docutils literal notranslate"><span class="pre">Pydefect</span></code> recommends a nearly isotropic (and sometimes cubic-like) supercell
composed of moderate number of atoms.
With the following command, one can create a <code class="code docutils literal notranslate"><span class="pre">SPOSCAR</span></code> file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">CONTCAR</span><span class="o">-</span><span class="n">finish</span>
</pre></div>
</div>
<p>If the input structure is different from the standardized primitive cell, <code class="code docutils literal notranslate"><span class="pre">NotPrimitiveError</span></code> is raised.</p>
<p>At present, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> constructs the supercell by expanding the <em>conventional</em> unitcell.
Generally speaking, it is possible to change the lattice angle of the supercell from those of the conventional unitcell.
For example, we can make a supercell in which a-, b-, and c-axes are mutually orthogonal for hexagonal systems.
However, it is not a good idea because such the lattice breaks the original symmetry,
which reduces the accuracy of the point-defect calculations and makes it difficult to analyze the symmetry at the defect site.
Therefore, we basically expand the lattice vector in their original directions.
One exception is the tetragonal cell, where the rotated supercells by 45 degrees keep the original symmetries.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, users can also specify the cell matrix, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">CONTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">--</span><span class="n">matrix</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The matrix is applied to the conventional cell.
Note, again, that if the symmetry is changed using an anisotropic supercell,
the following symmetry analysis is generally incorrect.</p>
<p>If one wants to know the conventional cell, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">si</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">CONTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">c</span>
</pre></div>
</div>
<p>See the help message for more details.</p>
<p>Since json files are generally less readable than yaml files,
we implement the <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command to generate readable command lines
from json files, which can be used as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_print</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> file is then shown as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="mi">43</span><span class="n">m</span>
<span class="n">Transformation</span> <span class="n">matrix</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Cell</span> <span class="n">multiplicity</span><span class="p">:</span> <span class="mi">32</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Mg1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">a</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
         <span class="n">Cutoff</span> <span class="n">radius</span><span class="p">:</span> <span class="mf">3.373</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Se&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">]}</span>
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">0.</span><span class="o">.</span><span class="mi">31</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.31</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">2</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Se1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
         <span class="n">Cutoff</span> <span class="n">radius</span><span class="p">:</span> <span class="mf">3.373</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">,</span> <span class="mf">2.59</span><span class="p">]}</span>
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">32.</span><span class="o">.</span><span class="mi">63</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">2.55</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
<p>With the <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> (= <code class="code docutils literal notranslate"><span class="pre">ds</span></code>) sub-command, we can build the <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> file.
An example of <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> for MgSe looks as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Al_Mg1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">Al_O1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">Mg_Al1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">O_Al1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">Va_Al1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">Va_Mg1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">Va_O1</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>where the combination of defect species and their charges are tabulated.
We can modify this file by hand if necessary or using <code class="code docutils literal notranslate"><span class="pre">--keywords</span></code> option.
If we want to add dopants, we can type as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">d</span> <span class="n">Ca</span>
</pre></div>
</div>
<p>There are some tips related to <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> and <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>.</p>
<p>1. The antisites and substituted defect species are determined from the difference of
the electronegativity between the substituted and removed atoms.
Default max difference is written in <a class="reference external" href="https://github.com/kumagai-group/pydefect/blob/master/pydefect/defaults.py">defaults.py</a>,
but one can change it via <code class="code docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>.
Since pydefect uses the <code class="code docutils literal notranslate"><span class="pre">DefaultsBase</span></code> in vise, the
rules are the same as <a class="reference external" href="https://kumagai-group.github.io/vise/tutorial_vise_yaml.html">vise.yaml</a>
except for the keywords.</p>
<p>2. The oxidation states determine the defect charge states.
For instance, the vacancies of Sn<sup>2+</sup> may take 0, -1, or -2 charge states,
while those of Sn<sup>4+</sup> between 0 and -4 charge states.
For the antisites and substituted defects,
<code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> considers all the possible combinations of vacancies and interstitials.
So, for example, Sn<sup>2+</sup> -on-S<sup>2-</sup> takes 0, +1, +2, +3, and +4 charge states.
The oxidation states are determined using the <code class="code docutils literal notranslate"><span class="pre">oxi_state_guesses</span></code> method of
<code class="code docutils literal notranslate"><span class="pre">Composition</span></code> class in <code class="code docutils literal notranslate"><span class="pre">pymatgen</span></code>.
The users can also manually set the oxidation states as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">--</span><span class="n">oxi_states</span> <span class="n">Mg</span> <span class="mi">4</span>
</pre></div>
</div>
<p>However, the recommended charge states may not be enough in some cases.
For instance, the Zn vacancies in ZnO are known to show the +1 charge state
because they can capture multiple polarons at the neighboring O sites.
See <a class="reference external" href="journals.aps.org/prb/abstract/10.1103/PhysRevB.95.094105">Frodason et al., Phys. Rev. B (2017)</a>
Users have to add these outliers by themselves.</p>
<p>3. By default, positions of atoms near the defect are perturbed
such that the symmetry is lowered to the P1 symmetry.
This is, however, unwanted in some cases because it increases the number of irreducible k-points
Then, <code class="code docutils literal notranslate"><span class="pre">displace_distance</span></code> needs to be set to 0 via <code class="code docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>.</p>
<p>4. If one wants to calculate particular defects e.g., only oxygen vacancies,
you can restrict the calculated defects with <code class="code docutils literal notranslate"><span class="pre">-k</span></code> option and a python regular expression,
For example, when typing as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">k</span> <span class="s2">&quot;Va_O[0-9]?_[0-9]+&quot;</span>
</pre></div>
</div>
<p>the following directories are created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="o">/</span> <span class="n">Va_O1_0</span><span class="o">/</span> <span class="n">Va_O1_1</span><span class="o">/</span> <span class="n">Va_O1_2</span><span class="o">/</span>
</pre></div>
</div>
<p>For regular expression, see <a class="reference external" href="https://docs.python.org/3/library/re.html">Regular expression operations</a>.</p>
</div>
<div class="section" id="decision-of-interstitial-sites">
<h2>6. Decision of interstitial sites<a class="headerlink" href="#decision-of-interstitial-sites" title="Permalink to this headline">¶</a></h2>
<p>In addition to the vacancies and substituted defects, one may want to take into account the interstitials.
Most people determine them by seeing the host crystal structures,
while there are a couple of procedures that recommend the interstitial sites.
It is, However, generally not an easy task to speculate the most likely interstitial sites
because they depend on the combination of the host and substituted elements.</p>
<p>The largest vacant space should be most likely interstitial sites
for positively charged cations with closed shells (e.g., Mg<sup>2+</sup>, Al<sup>3+</sup>),
as they tend not to make strong bonding with other atoms.
On the other hand, a proton (H<sup>+</sup>) prefers to be located near O<sup>2-</sup> or N<sup>3-</sup>
to form the strong O-H or N-H bonding.
Conversely, a hydride ion (H<sup>-</sup>) should tend to be located at a very much different place.
Therefore, we need to carefully determine the interstitial sites.</p>
<p><code class="code docutils literal notranslate"><span class="pre">Pydefect</span></code> holds a utility that recommends the interstitial sites based on
volumetric data such as the all electron charge density in the unitcell
using the <code class="code docutils literal notranslate"><span class="pre">ChargeDensityAnalyzer</span></code> class implemented in <code class="code docutils literal notranslate"><span class="pre">pymatgen</span></code>.</p>
<p>To use this, we need to generate volumetric data, e.g., <code class="code docutils literal notranslate"><span class="pre">AECCAR</span></code> and <code class="code docutils literal notranslate"><span class="pre">LOCPOT</span></code>,
based on the standardized primitive cell.
This has been already done in this tutorial at the DOS calculation.
This should not be done in general at the band structure calculations,
because the primitive cells may be different from the standardized primitive cell.</p>
<p>After running the vasp calculation, use the following command in the directory including AECCAR{0,2}.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">le</span> <span class="o">-</span><span class="n">v</span> <span class="n">AECCAR</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span> <span class="o">-</span><span class="n">i</span> <span class="n">all_electron_charge</span>
</pre></div>
</div>
<p>, which shows the local minima of the charge density as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">a</span>      <span class="n">b</span>      <span class="n">c</span>      <span class="n">value</span>  <span class="n">ave_value</span>
<span class="mi">0</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>   <span class="mf">3.387930</span>   <span class="mf">0.029844</span>
<span class="mi">1</span>  <span class="mf">0.625</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>   <span class="mf">3.383668</span>   <span class="mf">0.029845</span>
<span class="mi">2</span>  <span class="mf">0.125</span>  <span class="mf">0.625</span>  <span class="mf">0.125</span>   <span class="mf">3.383668</span>   <span class="mf">0.029845</span>
<span class="mi">3</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>  <span class="mf">0.625</span>   <span class="mf">3.383445</span>   <span class="mf">0.029845</span>
<span class="mi">4</span>  <span class="mf">0.500</span>  <span class="mf">0.500</span>  <span class="mf">0.500</span>  <span class="mf">16.501119</span>   <span class="mf">0.155178</span>
<span class="mi">5</span>  <span class="mf">0.750</span>  <span class="mf">0.750</span>  <span class="mf">0.750</span>  <span class="mf">16.501119</span>   <span class="mf">0.155178</span>
</pre></div>
</div>
<p>More details are shown in volumetric_data_local_extrema.json,
which can be checked with the <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="p">:</span> <span class="n">all_electron_charge</span>
<span class="n">min_or_max</span><span class="p">:</span> <span class="nb">min</span>
<span class="n">extrema_points</span><span class="p">:</span>
<span class="c1">#  site_sym  coordination                                                     frac_coords               quantity</span>
<span class="mi">1</span>  <span class="o">-</span><span class="mi">3</span><span class="n">m</span>       <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">]}</span>  <span class="p">(</span> <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">)</span>  <span class="mf">0.03</span>
<span class="mi">2</span>  <span class="o">-</span><span class="mi">43</span><span class="n">m</span>      <span class="p">{</span><span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">]}</span>  <span class="p">(</span> <span class="mf">0.500</span><span class="p">,</span>  <span class="mf">0.500</span><span class="p">,</span>  <span class="mf">0.500</span><span class="p">)</span>  <span class="mf">0.16</span>
</pre></div>
</div>
<p>Note, again, that the local minima may not be the best initial points for some interstitials,
so users must need to recognize the limit of this procedure.</p>
<p>To add the two interstitial sites,
we use the <code class="code docutils literal notranslate"><span class="pre">add_interstitials_from_local_extrema</span></code> (= <code class="code docutils literal notranslate"><span class="pre">ai</span></code>) sub-command as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_util</span> <span class="n">ai</span> <span class="o">--</span><span class="n">local_extrema</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">dos</span><span class="o">/</span><span class="n">volumetric_data_local_extrema</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">i</span> <span class="mi">1</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> file holds the information on the interstitial sites.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">--</span> <span class="n">interstitials</span>
<span class="c1">#1</span>
                  <span class="n">Info</span><span class="p">:</span> <span class="n">all_electron_charge</span> <span class="c1">#1</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">]}</span>

<span class="c1">#2</span>
                  <span class="n">Info</span><span class="p">:</span> <span class="n">all_electron_charge</span> <span class="c1">#2</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">]}</span>
</pre></div>
</div>
<p>To pop the interstitial sites, use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pi</span> <span class="o">-</span><span class="n">i</span> <span class="mi">1</span> <span class="o">-</span><span class="n">s</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>With this, the first interstitial site is removed from <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">--</span> <span class="n">interstitials</span>
<span class="c1">#1</span>
                  <span class="n">Info</span><span class="p">:</span> <span class="n">all_electron_charge</span> <span class="c1">#2</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">]}</span>
</pre></div>
</div>
<p>To consider these interstitials in <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>, run the <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> sub-command again.</p>
</div>
<div class="section" id="creation-of-defect-calculation-directories">
<h2>7. Creation of defect calculation directories<a class="headerlink" href="#creation-of-defect-calculation-directories" title="Permalink to this headline">¶</a></h2>
<p>We next create directories for the point-defect calculations
with the <code class="code docutils literal notranslate"><span class="pre">defect_entries</span></code> (= <code class="code docutils literal notranslate"><span class="pre">de</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">de</span>
</pre></div>
</div>
<p>With this command, the directories with defect names are created, including <code class="code docutils literal notranslate"><span class="pre">perfect/</span></code>.
If you again type the same command, the following information appears,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="p">:</span> <span class="n">perfect</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">O_i1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Mg_i1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Mg_i1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_3</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Mg_i1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_O1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">3</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_O1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_O1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">O_i1_</span><span class="o">-</span><span class="mi">2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">O_i1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Mg1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
</pre></div>
</div>
<p>and no directories are newly created.
This is a fail-safe treatment so as not to delete the calculated directories by mistake.
If you really want to recreate the directories, you need to remove them first.</p>
<p>In each directory, one can find there is a <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file,
which contains information about a point defect obtained before running the first-principles calculations.
To see <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code>, again use the <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">--</span> <span class="n">defect</span> <span class="n">entry</span> <span class="n">info</span>
<span class="n">name</span><span class="p">:</span> <span class="n">Va_O1_0</span>
<span class="n">site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">.</span><span class="mi">3</span><span class="n">m</span>
<span class="n">defect</span> <span class="n">center</span><span class="p">:</span> <span class="p">(</span> <span class="mf">0.861</span><span class="p">,</span>  <span class="mf">0.861</span><span class="p">,</span>  <span class="mf">0.861</span><span class="p">)</span>
<span class="n">perturbed</span> <span class="n">sites</span><span class="p">:</span>
<span class="n">elem</span> <span class="n">dist</span>   <span class="n">initial_coords</span>             <span class="n">perturbed_coords</span>         <span class="n">displacement</span>
  <span class="n">Al</span> <span class="mf">1.92</span> <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.637</span><span class="p">,</span>  <span class="mf">0.885</span><span class="p">,</span>  <span class="mf">0.864</span><span class="p">)</span>    <span class="mf">0.15</span>
  <span class="n">Al</span> <span class="mf">1.92</span> <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.879</span><span class="p">,</span>  <span class="mf">0.622</span><span class="p">,</span>  <span class="mf">0.884</span><span class="p">)</span>    <span class="mf">0.09</span>
  <span class="n">Al</span> <span class="mf">1.92</span> <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.625</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.624</span><span class="p">)</span>    <span class="mf">0.01</span>
  <span class="n">Mg</span> <span class="mf">1.94</span> <span class="p">(</span> <span class="mf">1.000</span><span class="p">,</span>  <span class="mf">1.000</span><span class="p">,</span>  <span class="mf">1.000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.004</span><span class="p">,</span>  <span class="mf">0.001</span><span class="p">,</span>  <span class="mf">0.006</span><span class="p">)</span>    <span class="mf">0.06</span>
</pre></div>
</div>
</div>
<div class="section" id="generation-of-defect-entry-json">
<h2>8. Generation of defect_entry.json<a class="headerlink" href="#generation-of-defect-entry-json" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, one may want to treat complex defects.
For instance, O<sub>2</sub> molecules act as anions in MgO<sub>2</sub>,
where O<sub>2</sub> molecule vacancies may be able to exist sufficiently.
Other important examples are the methylammonium lead halides (MAPI),
where methylammonium ions acts
as singly positive cations (CH<sub>3</sub>NH<sub>3</sub><sup>+</sup>), and DX centers,
where anion vacancies and interstitial cations coexist.</p>
<p>In these cases, one needs to prepare the input files and runs the vasp calculations by oneself.
However, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> necessitates the <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file for the postprocess,
which cannot be easily generated by the users.</p>
<p>In aid of this, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> provides the sub-command to create <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code>,
by analyzing the structure difference between the defect structure and perfect supercell structure.
The charge is determined from the INCAR, POSCAR, and POTCAR files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp_util</span> <span class="n">de</span> <span class="o">-</span><span class="n">d</span> <span class="o">.</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">perfect</span><span class="o">/</span><span class="n">POSCAR</span> <span class="o">-</span><span class="n">n</span> <span class="n">complex_defect</span>
</pre></div>
</div>
<p>This sub-command can also be used when one wants to use <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>
for analyzing the defect calculations that were already done previously.</p>
</div>
<div class="section" id="parsing-supercell-calculation-results">
<h2>9. Parsing supercell calculation results<a class="headerlink" href="#parsing-supercell-calculation-results" title="Permalink to this headline">¶</a></h2>
<p>We next run the vasp calculations on the point defects.
To create the vasp input files, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in */;do cd $i; vise vs -t defect ; cd ../;done
</pre></div>
</div>
<p>Do not forget to add the <code class="code docutils literal notranslate"><span class="pre">-t</span> <span class="pre">defect</span></code> option, to create the input files for defects.</p>
<p>When running the vasp calculations, we recommend the users to use the Gamma-only version
if the k point is sampled only at the Gamma point for large supercells.</p>
<p>After finishing the vasp calculations,
we can generate the <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code> that contains
the first-principles calculation results related to the defect properties.</p>
<p>By using the <code class="code docutils literal notranslate"><span class="pre">calc_results</span></code> (= <code class="code docutils literal notranslate"><span class="pre">cr</span></code>) sub-command,
we can generate <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code> in all the calculated directories.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cr</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="n">perfect</span>
</pre></div>
</div>
<p>When the calculations are in-progress, parsing of their directories are skipped automatically.</p>
</div>
<div class="section" id="corrections-of-defect-formation-energies-in-finite-size-supercells">
<h2>10. Corrections of defect formation energies in finite-size supercells<a class="headerlink" href="#corrections-of-defect-formation-energies-in-finite-size-supercells" title="Permalink to this headline">¶</a></h2>
<p>When the supercell is adopted under the periodic boundary condition,
the total energies for <strong>charged defects</strong> are not properly estimated
due to interactions between a defect, its images, and background charge.
Therefore, we need to correct the total energies of the charged defect supercells
to those in the dilution limit.</p>
<p>The corrections are performed using the <code class="code docutils literal notranslate"><span class="pre">extended_fnv_correction</span></code> (= <code class="code docutils literal notranslate"><span class="pre">efnv</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">efnv</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>For the corrections, we need the static dielectric constants
and atomic site potentials in the perfect supercell.
Therefore, the paths to <code class="code docutils literal notranslate"><span class="pre">unitcell.yaml</span></code> and <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code>
in the <code class="code docutils literal notranslate"><span class="pre">perfect</span></code> directory must be assigned.
Bear also in mind that this command takes some time.</p>
<p>The energy correction in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> at this moment is now performed with
the so-called extended Freysoldt-Neugebauer-Van de Walle (eFNV) method.
If one uses the corrections, please cite the following papers.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.102.016402">C. Freysoldt, J. Neugebauer, and C. Van de Walle, Fully Ab Initio Finite-Size Corrections for Charged-Defect Supercell Calculations, Phys. Rev. Lett., 102 016402 (2009).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai* and F. Oba, Electrostatics-based finite-size corrections for first-principles point defect calculations, Phys. Rev. B, 89 195205 (2014).</a></p></li>
</ul>
<p>One obtains <code class="code docutils literal notranslate"><span class="pre">correction.pdf</span></code> file, which contains information
about defect-induced and point-charge potential,
and their differences at atomic sites as shown below.</p>
<img alt="_images/correction.png" src="_images/correction.png" />
<p>The height of the horizontal line indicates the averaged potential difference
between the point-charge potential and that caused by the defect,
namely potential in the defective supercell minus that in the perfect supercell.
The range of the line means the averaged region. See
<a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai* and F. Oba (2014)</a>
for details.</p>
<p>When performing the corrections, it is strongly recommended to check
all the <code class="code docutils literal notranslate"><span class="pre">correction.pdf</span></code> files for the calculated defects
so as to reduce careless mistakes as much as possible.</p>
</div>
<div class="section" id="check-defect-structures">
<h2>11. Check defect structures<a class="headerlink" href="#check-defect-structures" title="Permalink to this headline">¶</a></h2>
<p>We analyze the defect local structures using the <code class="code docutils literal notranslate"><span class="pre">defect_structure_info</span></code> (= <code class="code docutils literal notranslate"><span class="pre">dsi</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">dsi</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">defect_structure_info.json</span></code> files are created, which are shown using <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">--</span> <span class="n">defect</span> <span class="n">structure</span> <span class="n">info</span>
<span class="n">Defect</span> <span class="nb">type</span><span class="p">:</span> <span class="n">vacancy</span>
<span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="p">(</span><span class="n">same</span><span class="p">)</span>
<span class="n">Has</span> <span class="n">same</span> <span class="n">configuration</span> <span class="kn">from</span> <span class="nn">initial</span> <span class="n">structure</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">Drift</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">0.022</span>
<span class="n">Defect</span> <span class="n">center</span><span class="p">:</span> <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">,</span>  <span class="mf">0.372</span><span class="p">)</span>
<span class="n">Removed</span> <span class="n">atoms</span><span class="p">:</span>
<span class="mi">8</span>  <span class="n">Al</span>  <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">)</span>

<span class="n">Neighbor</span> <span class="nb">max</span> <span class="n">distance</span> <span class="mf">2.472</span>
<span class="n">Displacements</span>
<span class="n">Elem</span>  <span class="n">Dist</span>  <span class="n">Displace</span>  <span class="n">Angle</span>  <span class="n">Index</span>  <span class="n">Initial</span> <span class="n">site</span>                  <span class="n">Final</span> <span class="n">site</span>                <span class="n">Neighbor</span>
<span class="n">O</span>     <span class="mf">1.9</span>   <span class="mf">0.26</span>      <span class="mi">160</span>    <span class="mi">46</span>     <span class="p">(</span> <span class="mf">0.639</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">,</span>  <span class="mf">0.139</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.647</span><span class="p">,</span>  <span class="mf">0.353</span><span class="p">,</span>  <span class="mf">0.108</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.92</span>  <span class="mf">0.26</span>      <span class="mi">160</span>    <span class="mi">42</span>     <span class="p">(</span> <span class="mf">0.639</span><span class="p">,</span>  <span class="mf">0.139</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.647</span><span class="p">,</span>  <span class="mf">0.110</span><span class="p">,</span>  <span class="mf">0.351</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.92</span>  <span class="mf">0.26</span>      <span class="mi">160</span>    <span class="mi">26</span>     <span class="p">(</span> <span class="mf">0.861</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.890</span><span class="p">,</span>  <span class="mf">0.353</span><span class="p">,</span>  <span class="mf">0.351</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.92</span>  <span class="mf">0.24</span>      <span class="mi">170</span>    <span class="mi">47</span>     <span class="p">(</span> <span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.360</span><span class="p">,</span>  <span class="mf">0.396</span><span class="p">,</span>  <span class="mf">0.394</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.93</span>  <span class="mf">0.24</span>      <span class="mi">170</span>    <span class="mi">31</span>     <span class="p">(</span> <span class="mf">0.611</span><span class="p">,</span>  <span class="mf">0.611</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.604</span><span class="p">,</span>  <span class="mf">0.639</span><span class="p">,</span>  <span class="mf">0.394</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.94</span>  <span class="mf">0.23</span>      <span class="mi">160</span>    <span class="mi">35</span>     <span class="p">(</span> <span class="mf">0.611</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.611</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.604</span><span class="p">,</span>  <span class="mf">0.396</span><span class="p">,</span>  <span class="mf">0.637</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">Al</span>    <span class="mf">2.85</span>  <span class="mf">0.03</span>      <span class="mi">30</span>     <span class="mi">14</span>     <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.627</span><span class="p">,</span>  <span class="mf">0.128</span><span class="p">,</span>  <span class="mf">0.127</span><span class="p">)</span>
<span class="n">Al</span>    <span class="mf">2.85</span>  <span class="mf">0.03</span>      <span class="mi">30</span>     <span class="mi">21</span>     <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.872</span><span class="p">,</span>  <span class="mf">0.373</span><span class="p">,</span>  <span class="mf">0.127</span><span class="p">)</span>
<span class="n">Al</span>    <span class="mf">2.87</span>  <span class="mf">0.05</span>      <span class="mi">40</span>     <span class="mi">16</span>     <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.872</span><span class="p">,</span>  <span class="mf">0.128</span><span class="p">,</span>  <span class="mf">0.372</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also create <a class="reference external" href="https://jp-minerals.org/vesta/en/">VESTA</a> file for analyzing the defect structure
using the defect_vesta_file(=dvf) sub-command in pydefect_util.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_util</span> <span class="n">dvf</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span>
</pre></div>
</div>
<p>which creates defect.vesta files.</p>
</div>
<div class="section" id="check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations">
<h2>12. Check defect eigenvalues and band-edge states in supercell calculations<a class="headerlink" href="#check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations" title="Permalink to this headline">¶</a></h2>
<p>** Note: This section is optional.**</p>
<p>Generally, point defects are categorized into three types.</p>
<p>(1) Defects with deep localized states located inside the band gap.
This type of defect is generally considered to be detrimental
for device performances as the carriers are trapped by the localized states.
Furthermore, they could act as color centers, as represented by the vacancies in NaCl.
Therefore, it is important to know the position of the localized state and its origin.</p>
<p>(2) Defects with hydrogenic carrier states, or perturbed host states (PHS),
where carriers are located at the band edges with loosely trapped by the charged defect centers.
Examples are the B-on-Si (p-type) and P-on-Si (n-type) substitutional dopants in Si.
These defects also do little harm for device performances,
but introduce the carrier electrons/holes or kill counter carriers.
The wavefunctions of the PHS could distribute over several million atoms.
Therefore, calculations of their thermodynamical transition levels
require supergiant supercell calculations, which are almost prohibitive with first-principles calculations thus far.
Therefore, we instead usually avoid calculating these quantities and
denote that the defects have PHS and their transition energies are located near the band edges only qualitatively.</p>
<p>(3) Defects without any defect states inside the band gap or near the band edges,
which would not largely affect the electronic properties as long as their concentrations are not exceedingly high.</p>
<p>See some examples from our published papers.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://link.aps.org/pdf/10.1103/PhysRevB.90.125202">Y. Kumagai*, M. Choi, Y. Nose, and F. Oba, First-principles study of point defects in chalcopyrite ZnSnP2, Phys. Rev. B, 90 125202 (2014).</a></p></li>
<li><p><a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevApplied.6.014009">Y. Kumagai*, L. A. Burton, A. Walsh, and F. Oba, Electronic structure and defect physics of tin sulfides: SnS, Sn2S3, and SnS2, Phys. Rev. Applied, 6 014009 (2016).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.8.014015)">Y. Kumagai*, K. Harada, H. Akamatsu, K. Matsuzaki, and F. Oba, Carrier-Induced Band-Gap Variation and Point Defects in Zn3N2 from First Principles, Phys. Rev. Applied, 8 014015 (2017).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.9.034019">Y. Kumagai*, N. Tsunoda, and F. Oba, Point defects and p-type doping in ScN from first principles, Phys. Rev. Applied, 9 034019 (2018).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.10.011001">N. Tsunoda, Y. Kumagai*, A. Takahashi, and F. Oba, Electrically benign defect behavior in ZnSnN2 revealed from first principles, Phys. Rev. Applied, 10 011001 (2018).</a></p></li>
</ul>
<p>To distinguish these three types of defects, one needs to look see the defect levels and orbitals
and judge if the defects create the PHS and/or defect localized states.</p>
<p><code class="code docutils literal notranslate"><span class="pre">Pydefect</span></code> analyzes the eigenvalues and band-edge states by the following steps.</p>
<p>Firstly, one generates the <code class="code docutils literal notranslate"><span class="pre">perfect_band_edge_state.json</span></code> files
using the <code class="code docutils literal notranslate"><span class="pre">perfect_band_edge_state</span></code> sub-command,
which shows the information on the eigenvalues and orbital information of the VBM and CBM in the perfect supercell.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">pbes</span> <span class="o">-</span><span class="n">d</span> <span class="n">perfect</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">band_edge_orbital_infos.json</span></code> files are then created at defect directories using
the <code class="code docutils literal notranslate"><span class="pre">band_edge_orbital_infos</span></code> (= <code class="code docutils literal notranslate"><span class="pre">beoi</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">beoi</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">pbes</span> <span class="n">perfect</span><span class="o">/</span><span class="n">perfect_band_edge_state</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">eigenvalues.pdf</span></code> files  are also created.</p>
<img alt="_images/eigenvalues.png" src="_images/eigenvalues.png" />
<p>Here, one can see single-particle levels and their occupation in the spin-up and -down channels.
The x-axis is fractional coordinates of the calculated k points,
while the y-axis in the absolute energy scale.
Filled circles inside the figures are single particle levels at each k point.
If the defect is spin polarized, two panels are shown; the left one is for spin up while the right one for spin down.</p>
<p>Two horizontal dashed lines indicate the VBM and CBM in the <strong>perfect supercell</strong>.
The discrete numbers in the figures mean the band indices starting from 1,
and the filled red, green, and blue circles mean the occupied,
partially occupied (from 0.2 to 0.8), and unoccupied eigenstates, respectively.</p>
<p>We then generate the <code class="code docutils literal notranslate"><span class="pre">edge_characters.json</span></code> files
with the <code class="code docutils literal notranslate"><span class="pre">band_edge_states</span></code> (= <code class="code docutils literal notranslate"><span class="pre">bes</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">bes</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pbes</span> <span class="n">perfect</span><span class="o">/</span><span class="n">perfect_band_edge_state</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Using the <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command, the file shows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">--</span> <span class="n">band</span><span class="o">-</span><span class="n">edge</span> <span class="n">states</span> <span class="n">info</span>
<span class="n">Spin</span><span class="o">-</span><span class="n">up</span>
     <span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">OrbDiff</span>  <span class="n">Orbitals</span>                          <span class="n">K</span><span class="o">-</span><span class="n">point</span> <span class="n">coords</span>
<span class="n">VBM</span>  <span class="mi">128</span>    <span class="mf">3.727</span>   <span class="mf">0.33</span>     <span class="mf">1.00</span>        <span class="mf">0.02</span>     <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.76</span>                         <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">CBM</span>  <span class="mi">129</span>    <span class="mf">9.980</span>   <span class="mf">0.06</span>     <span class="mf">0.00</span>        <span class="mf">0.03</span>     <span class="n">Al</span><span class="o">-</span><span class="n">s</span><span class="p">:</span> <span class="mf">0.11</span><span class="p">,</span> <span class="n">O</span><span class="o">-</span><span class="n">s</span><span class="p">:</span> <span class="mf">0.21</span><span class="p">,</span> <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.11</span>  <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">vbm</span> <span class="n">has</span> <span class="n">acceptor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.000</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">cbm</span> <span class="n">has</span> <span class="n">donor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.000</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="o">---</span>
<span class="n">Localized</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">Orbitals</span>

<span class="n">Spin</span><span class="o">-</span><span class="n">down</span>
     <span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">OrbDiff</span>  <span class="n">Orbitals</span>              <span class="n">K</span><span class="o">-</span><span class="n">point</span> <span class="n">coords</span>
<span class="n">VBM</span>  <span class="mi">126</span>    <span class="mf">4.083</span>   <span class="mf">0.67</span>     <span class="mf">0.88</span>        <span class="mf">0.06</span>     <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.72</span>             <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">CBM</span>  <span class="mi">129</span>    <span class="mf">10.010</span>  <span class="mf">0.06</span>     <span class="mf">0.00</span>        <span class="mf">0.01</span>     <span class="n">O</span><span class="o">-</span><span class="n">s</span><span class="p">:</span> <span class="mf">0.21</span><span class="p">,</span> <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.11</span>  <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">vbm</span> <span class="n">has</span> <span class="n">acceptor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.120</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">cbm</span> <span class="n">has</span> <span class="n">donor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.000</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="o">---</span>
<span class="n">Localized</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">Orbitals</span>
<span class="mi">127</span>    <span class="mf">4.277</span>   <span class="mf">0.62</span>     <span class="mf">0.06</span>        <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">2.98</span>
<span class="mi">128</span>    <span class="mf">4.278</span>   <span class="mf">0.62</span>     <span class="mf">0.06</span>        <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">2.98</span>
</pre></div>
</div>
<p>The orbital information at each spin channel is shown.
Here, <code class="code docutils literal notranslate"><span class="pre">P-ratio</span></code> means the participation ratio,
which is a ratio of the projected orbitals at the neighboring atoms shown in the <code class="code docutils literal notranslate"><span class="pre">defect_structure_info.json</span></code>
to the sum of those at all the sites.</p>
<p>As mentioned, the formation energies of the defects with the occupied
<code class="code docutils literal notranslate"><span class="pre">donor</span> <span class="pre">phs</span></code> or unoccupied <code class="code docutils literal notranslate"><span class="pre">acceptor</span> <span class="pre">phs</span></code> should be omitted from the energy plot.
In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, the <code class="code docutils literal notranslate"><span class="pre">donor</span> <span class="pre">phs</span></code> and <code class="code docutils literal notranslate"><span class="pre">acceptor</span> <span class="pre">phs</span></code> are determined from the eigenvalues
and the similarity of the wavefunction to those of the VBM and CBM.
See our paper that will appear soon for details.</p>
<p>We emphasize that the automatically determined band-edge states could be incorrect
as it is generally difficult to determine them automatically.
Therefore, please carefully check the band-edge states,
and draw their band-decomposed charge density if the band-edge states are not obvious.</p>
</div>
<div class="section" id="plot-defect-formation-energies">
<h2>13. Plot defect formation energies<a class="headerlink" href="#plot-defect-formation-energies" title="Permalink to this headline">¶</a></h2>
<p>Here, we show how to plot the defect formation energies.</p>
<p>The plot of the defect formation energies requires multiple information,
namely the band edges, chemical potentials of the competing phases,
and total energies of the perfect and defective supercells.</p>
<p>Firstly, we use the <code class="code docutils literal notranslate"><span class="pre">defect_energy_infos</span></code> (= <code class="code docutils literal notranslate"><span class="pre">dei</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">dei</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">s</span> <span class="o">../</span><span class="n">cpd</span><span class="o">/</span><span class="n">standard_energies</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>which creates the <code class="code docutils literal notranslate"><span class="pre">defect_energy_info.yaml</span></code> files in defect directories.
An example is shown as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">Va_O1</span>
<span class="n">charge</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">formation_energy</span><span class="p">:</span> <span class="mf">6.803585744999999</span>
<span class="n">atom_io</span><span class="p">:</span>
  <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">energy_corrections</span><span class="p">:</span>
  <span class="n">pc</span> <span class="n">term</span><span class="p">:</span> <span class="mf">0.0</span>
  <span class="n">alignment</span> <span class="n">term</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span>
<span class="n">is_shallow</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Caveats:
(1) The formation_energy is the defect formation energy estimated under the situation
where elements’ chemical potentials are set at their standard states and the Fermi level is located at energy zero.
(2) Two energy_corrections are written but one can add their original correction if needed.
(3) is_shallow is empty when the previous section is skipped.
One can modify the calculation results such as shallow states manually by hand.</p>
<p>We then create a <code class="code docutils literal notranslate"><span class="pre">defect_energy_summary.json</span></code> file with the <code class="code docutils literal notranslate"><span class="pre">defect_energy_summary</span></code> (= <code class="code docutils literal notranslate"><span class="pre">des</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">des</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">pbes</span> <span class="n">perfect</span><span class="o">/</span><span class="n">perfect_band_edge_state</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">t</span> <span class="o">../</span><span class="n">cpd</span><span class="o">/</span><span class="n">target_vertices</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>This sub-command collect the information written in the <code class="code docutils literal notranslate"><span class="pre">defect_energy_info.yaml</span></code> files to <code class="code docutils literal notranslate"><span class="pre">defect_energy_summary.json</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>title: MgAl₂O₄
rel_chem_pots:
 -A Al: 0.00 Mg: -0.69 O: -5.25
 -B Al: 0.00 Mg: -0.32 O: -5.34
 -C Al: -7.87 Mg: -5.94 O: 0.00
 -D Al: -8.01 Mg: -5.66 O: 0.00
vbm: 0.00, cbm: 5.22, supercell vbm: -0.03, supercell_cbm: 6.14

name    atom_io         charge    energy    correction  is_shallow
------  ------------  --------  --------  ------------  ------------
Al_i1   Al: 1               -1    14.958        -0.049  False
                             0     9.896         0.000  True
                             1     3.376         0.527  False
                             2    -0.872         1.814  True
                             3    -6.994         3.370  False
Mg_i1   Mg: 1                0     8.208         0.000  True
                             1     2.015         0.555  True
                             2    -4.117         1.534  False
O_i1    O: 1                -2     8.122         0.721  False
                            -1     7.055         0.149  False
                             0     4.566         0.000  False
Va_Al1  Al: -1              -3    13.527         3.402  False
                            -2    12.968         1.789  True
                            -1    12.672         0.660  True
                             0    12.595         0.000  True
                             1    12.710        -0.232  True
Va_Mg1  Mg: -1              -2    10.093         1.524  False
                            -1     9.580         0.578  True
                             0     9.311         0.000  False
Va_MgO  O: -1 Mg: -1         0     9.887         0.000  False
Va_O1   O: -1                0     6.804         0.000  False
                             1     3.808         0.166  False
                             2     0.883         0.845  False
</pre></div>
</div>
<p>We can also create the <code class="code docutils literal notranslate"><span class="pre">calc_summary.json</span></code> file with the <code class="code docutils literal notranslate"><span class="pre">calc_summary</span></code> (= <code class="code docutils literal notranslate"><span class="pre">cs</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cs</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>which shows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="p">:</span><span class="o">---------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">----------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">-----------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">-----------------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">------------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">------------------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">--------------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span>   <span class="n">name</span>    <span class="o">|</span> <span class="n">Ele</span><span class="o">.</span> <span class="n">conv</span><span class="o">.</span> <span class="o">|</span> <span class="n">Ionic</span> <span class="n">conv</span><span class="o">.</span> <span class="o">|</span> <span class="n">Is</span> <span class="n">energy</span> <span class="n">strange</span> <span class="o">|</span> <span class="n">Same</span> <span class="n">config</span><span class="o">.</span> <span class="o">|</span>    <span class="n">Defect</span> <span class="nb">type</span>     <span class="o">|</span> <span class="n">Symm</span><span class="o">.</span> <span class="n">Relation</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Al_i1_</span><span class="o">-</span><span class="mi">1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_3</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Mg_i1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Mg_i1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Mg_i1_2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">O_i1_</span><span class="o">-</span><span class="mi">1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">O_i1_</span><span class="o">-</span><span class="mi">2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span> <span class="n">interstitial_split</span> <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">O_i1_0</span>   <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">2</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">3</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">2</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Mg1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_MgO_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>      <span class="n">same</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="n">Va_O1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Va_O1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Va_O1_2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
</pre></div>
</div>
<p>However, this is still a beta version.</p>
<p>Finally, the defect formation energies are plotted as a function of the Fermi level
with the <code class="code docutils literal notranslate"><span class="pre">plot_defect_formation_energy</span></code> (= <code class="code docutils literal notranslate"><span class="pre">pe</span></code>) sub-command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pe</span> <span class="o">-</span><span class="n">d</span> <span class="n">defect_energy_summary</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">l</span> <span class="n">A</span>
</pre></div>
</div>
<p>which shows like,</p>
<img alt="_images/energy_A.png" src="_images/energy_A.png" />
<p>When changing the condition of the chemical potential,
namely the position of the vertex in the chemical potential diagram,
use the <code class="code docutils literal notranslate"><span class="pre">-l</span></code> option.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="first_principles_calc.html" class="btn btn-neutral float-right" title="Tips for first-principles calculations for point defects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to pydefect documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Yu Kumagai

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>