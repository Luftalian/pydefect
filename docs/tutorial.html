<!doctype html>
<html class="no-js" data-content_root="./" lang="en">
  <head><meta charset="utf-8"/>
    <meta content="width=device-width,initial-scale=1" name="viewport"/>
    <meta content="light dark" name="color-scheme"><meta content="width=device-width, initial-scale=1" name="viewport" />
<link href="genindex.html" rel="index" title="Index" /><link href="search.html" rel="search" title="Search" /><link href="concentrations.html" rel="next" title="Tutorial of how to calculate carrier and defect concentration using pydefect" /><link href="index.html" rel="prev" title="Welcome to pydefect documentation!" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Tutorial of pydefect - pydefect documentation</title>
      <link href="_static/pygments.css?v=8f2a1f02" rel="stylesheet" type="text/css" />
    <link href="_static/styles/furo.css?v=354aac6f" rel="stylesheet" type="text/css" />
    <link href="_static/styles/furo-extensions.css?v=302659d7" rel="stylesheet" type="text/css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg class="feather-menu" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <line x1="3" x2="21" y1="12" y2="12"></line>
      <line x1="3" x2="21" y1="6" y2="6"></line>
      <line x1="3" x2="21" y1="18" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg class="feather-chevron-right" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg class="feather-sun" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" x2="12" y1="1" y2="3"></line>
      <line x1="12" x2="12" y1="21" y2="23"></line>
      <line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
      <line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
      <line x1="1" x2="3" y1="12" y2="12"></line>
      <line x1="21" x2="23" y1="12" y2="12"></line>
      <line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
      <line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg class="icon-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="none" stroke="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg class="icon-custom-derived-from-feather-sun-and-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg">
      <path d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z" style="opacity: 50%"/>
      <line x1="14.5" x2="14.5" y1="3.25" y2="1.25"/>
      <line x1="14.5" x2="14.5" y1="15.85" y2="17.85"/>
      <line x1="10.044" x2="8.63" y1="5.094" y2="3.68"/>
      <line x1="19" x2="20.414" y1="14.05" y2="15.464"/>
      <line x1="8.2" x2="6.2" y1="9.55" y2="9.55"/>
      <line x1="20.8" x2="22.8" y1="9.55" y2="9.55"/>
      <line x1="10.044" x2="8.63" y1="14.006" y2="15.42"/>
      <line x1="19" x2="20.414" y1="5.05" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg class="icon-custom-derived-from-feather-sun-and-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" x2="18" y1="3.705" y2="2.5"/>
      <line style="opacity: 50%" x1="18" x2="18" y1="11.295" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" x2="14.464" y1="4.816" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" x2="21.563" y1="10.212" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" x2="13.001" y1="7.5" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" x2="23" y1="7.5" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" x2="14.464" y1="10.184" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" x2="21.563" y1="4.789" y2="3.937"/>
      <circle cx="18" cy="7.5" r="2.169" style="opacity: 50%"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg class="icon-tabler-pencil-code" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg class="icon-tabler-eye-code" fill="none" stroke="currentColor" stroke-linecap="round"
      stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="none" stroke="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox">
<input class="sidebar-toggle" id="__toc" name="__toc" type="checkbox">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">pydefect  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">pydefect  documentation</span>
  
</a><form action="search.html" class="sidebar-search-container" method="get" role="search">
  <input aria-label="Search" class="sidebar-search" name="q" placeholder="Search">
  <input name="check_keywords" type="hidden" value="yes">
  <input name="area" type="hidden" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Tutorial of pydefect</a></li>
<li class="toctree-l1"><a class="reference internal" href="concentrations.html">Tutorial of how to calculate carrier and defect concentration using pydefect</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_principles_calc.html">Tips for first-principles calculations for point defects</a></li>
<li class="toctree-l1"><a class="reference internal" href="vertical_transition_level.html">Tutorial for calculation of vertical transition level</a></li>
<li class="toctree-l1"><a class="reference internal" href="change_log.html">Change log</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a class="back-to-top muted-link" href="#">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/tutorial.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article id="furo-main-content" role="main">
          <section id="tutorial-of-pydefect">
<h1>Tutorial of pydefect<a class="headerlink" href="#tutorial-of-pydefect" title="Link to this heading">¶</a></h1>
<p>This page explains how to use the <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> code.</p>
<p>Note 1: Pydefect currently supports only the Vienna Ab-initio Simulation Package (VASP).
Therefore, it assumes the use of VASP-specific input and output file names
(e.g., POSCAR, POTCAR, OUTCAR) as well as computational methods such as periodic boundary conditions.</p>
<p>Note 2: The units used in Pydefect follow the VASP convention:
energy is in electronvolts (eV) and length is in angstroms (Å).</p>
<p>Note 3: At present, only nonmagnetic host materials are supported.</p>
<p>The workflow for point-defect calculations in non-metallic solids is illustrated below.
Some tasks can be performed in parallel, while others must be carried out sequentially.
Since these procedures are often complex and time-consuming, researchers are prone to making mistakes.</p>
<p>The primary goal of <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> is to provide an automated system
for point-defect calculations in non-metallic materials.
This helps researchers save time and minimize human error.</p>
<img alt="_images/pydefect.png" src="_images/pydefect.png" />
<p>This cheat sheet is divided into three parts: unitcell, chemical potential diagram (cpd), and defect,
each corresponding to a working directory, as illustrated below.</p>
<p>Red text indicates related commands, while blue text denotes the files generated by those commands.
Branches represent alternative workflows or options.
Filled blue rectangles indicate steps that require VASP calculations.
Bolded rectangles represent steps that involve multiple directories related to the considered defects.
Green rectangles indicate optional steps.</p>
<p>Here, we assume the following directory structure.
The placeholder <code class="code docutils literal notranslate"><span class="pre">&lt;project_name&gt;</span></code> typically represents the name of the target material,
optionally including its crystal structure — for example, rutile-TiO:sub:2``.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;project_name&gt;
 │
 ├ pydefect.yaml
 ├ vise.yaml
 │
 ├ unitcell/ ── structure_opt/
 │            ├ band/
 │            ├ dielectric/
 │            └ dos/
 │
 ├ cpd/ ──── &lt;competing_phase 1&gt;
 │       ├── &lt;competing_phase 2&gt;
 │           ....
 │
 └ defect/ ── perfect/
            ├─ Va_X_0/
            ├─ Va_X_1/
            ├─ Va_X_2/
             ...
</pre></div>
</div>
<p>We recommend that users follow the same directory structure if possible.
The details of the workflow are explained step by step, using an example of MgAl₂O₄ calculated with the PBEsol functional.</p>
<p>In :code:pydefect, there are five main command-line tools:</p>
<p><code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>
<code class="code docutils literal notranslate"><span class="pre">pydefect_vasp</span></code>
<code class="code docutils literal notranslate"><span class="pre">pydefect_util</span></code>
<code class="code docutils literal notranslate"><span class="pre">pydefect_vasp_util</span></code>
<code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code>
The commands <code class="code docutils literal notranslate"><span class="pre">pydefect_vasp</span></code> and <code class="code docutils literal notranslate"><span class="pre">pydefect_vasp_util</span></code> are related to VASP,
while <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> and <code class="code docutils literal notranslate"><span class="pre">pydefect_util</span></code> are independent of any specific DFT code.
Commands with the suffix <code class="code docutils literal notranslate"><span class="pre">_util</span></code> are not strictly necessary, but they can be useful in certain situations.</p>
<p>Each subcommand supports a variety of arguments.
You can always display the help message using the <code class="code docutils literal notranslate"><span class="pre">-h</span></code> flag. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>to view detailed information.</p>
<section id="relaxation-of-the-unit-cell">
<h2>1. Relaxation of the unit cell<a class="headerlink" href="#relaxation-of-the-unit-cell" title="Link to this heading">¶</a></h2>
<p>Point-defect calculations are typically performed on a theoretically relaxed structure,
using a specified exchange-correlation functional and projector augmented wave (PAW) potentials.
This ensures that the structure is free from artificial strain and stress,
which can otherwise introduce unwanted dependencies on the supercell size.
Therefore, the first step is usually to optimize the lattice constants
and the fractional atomic coordinates in the unit cell.</p>
<p>We first prepare the <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> file of the pristine bulk unit cell,
and create the <code class="code docutils literal notranslate"><span class="pre">unitcell/</span></code> directory and its subdirectory <code class="code docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code>
(using <code class="code docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">unitcell/structure_opt/</span></code>), then move into it.
(In this tutorial, any name ending with <code class="code docutils literal notranslate"><span class="pre">/</span></code> indicates a directory.)
When <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> needs to generate VASP input files,
namely <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">POTCAR</span></code>, and <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code>,
we use the <a class="reference external" href="https://kumagai-group.github.io/vise/">vise</a>
(short for <code class="code docutils literal notranslate"><span class="pre">vasp</span> <span class="pre">integrated</span> <span class="pre">supporting</span> <span class="pre">environment</span></code>),
which creates input files for various tasks and exchange-correlation (XC) functionals.
<code class="code docutils literal notranslate"><span class="pre">vise</span></code> depends on <a class="reference external" href="http://pymatgen.org">pymatgen</a>, and therefore,
as explained in <a class="reference external" href="https://pymatgen.org/usage.html">pymatgen usage page 1</a> or
<a class="reference external" href="https://pymatgen.org/_modules/pymatgen/io/vasp/inputs.html">page 2</a>,
you need to set the <code class="code docutils literal notranslate"><span class="pre">PMG_DEFAULT_FUNCTIONAL</span></code> and <code class="code docutils literal notranslate"><span class="pre">PMG_VASP_PSP_DIR</span></code>
in the <code class="code docutils literal notranslate"><span class="pre">.pmgrc.yaml</span></code> file located in your home directory. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMG_DEFAULT_FUNCTIONAL</span><span class="p">:</span> <span class="n">PBE_54</span>
<span class="n">PMG_MAPI_KEY</span><span class="p">:</span> <span class="n">xxxxxxxxxxxxxxxx</span>
<span class="n">PMG_VASP_PSP_DIR</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">kumagai</span><span class="o">/</span><span class="n">potcars</span><span class="o">/</span>
</pre></div>
</div>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, <code class="code docutils literal notranslate"><span class="pre">PMG_MAPI_KEY</span></code> is required to query
<code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> files and the total energies of competing materials.</p>
<p>Input files for optimizing a unit cell using the PBEsol functional
can be generated with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vasp_set</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span>
</pre></div>
</div>
<p>Here, <code class="code docutils literal notranslate"><span class="pre">vasp_set</span></code>, or its abbreviation <code class="code docutils literal notranslate"><span class="pre">vs</span></code>,
is a subcommand of the main <code class="code docutils literal notranslate"><span class="pre">vise</span></code> function.
Similarly, all subcommands in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> and <code class="code docutils literal notranslate"><span class="pre">vise</span></code> have their own abbreviations.</p>
<p>Since the PBE functional is the default in <code class="code docutils literal notranslate"><span class="pre">vise</span></code>,
we use the <code class="code docutils literal notranslate"><span class="pre">-x</span></code> argument to switch the XC functional to PBEsol.</p>
<p>Note that structure optimization generally needs to be repeated
with a 1.3× larger cutoff energy until both the forces and stresses
are well converged at the first ionic step.
See the <a class="reference external" href="https://www.vasp.at/wiki/index.php/Energy_vs_volume_Volume_relaxations_and_Pulay_stress">vasp manual</a>
for further details.</p>
<p>This iterative process is not supported by <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>,
but it can easily be implemented using a simple shell script.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, users can control various default parameters
via the <code class="code docutils literal notranslate"><span class="pre">vise.yaml</span></code> file used by <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.
See the <a class="reference external" href="https://kumagai-group.github.io/vise/">vise documentation</a> for more information.
The set of configurable parameters can be found in <code class="code docutils literal notranslate"><span class="pre">defaults.py</span></code> in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>.</p>
</section>
<section id="calculation-of-band-dos-and-dielectric-tensor">
<h2>2. Calculation of band, DOS, and dielectric tensor<a class="headerlink" href="#calculation-of-band-dos-and-dielectric-tensor" title="Link to this heading">¶</a></h2>
<p>We then calculate the band structure (BS), density of states (DOS), and dielectric constants.
In defect calculations, the BS is used to determine the valence band maximum (VBM)
and conduction band minimum (CBM), while the dielectric constant, defined as the sum
of the electronic (ion-clamped) and ionic dielectric tensors, is required for correcting
the defect formation energies.</p>
<p>First, create the <code class="code docutils literal notranslate"><span class="pre">band/</span></code>, <code class="code docutils literal notranslate"><span class="pre">dos/</span></code>, and <code class="code docutils literal notranslate"><span class="pre">dielectric/</span></code> directories inside <code class="code docutils literal notranslate"><span class="pre">unitcell/</span></code>,
copy the <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> file from <code class="code docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code>,
and run the following command in each directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="n">t</span> <span class="n">band</span> <span class="o">-</span><span class="n">pd</span> <span class="o">../</span><span class="n">structure_opt</span>
<span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="n">t</span> <span class="n">dos</span> <span class="o">-</span><span class="n">pd</span> <span class="o">../</span><span class="n">structure_opt</span> <span class="o">-</span><span class="n">uis</span> <span class="n">LVTOT</span> <span class="kc">True</span> <span class="n">LAECHG</span> <span class="kc">True</span> <span class="n">KPAR</span> <span class="mi">1</span>
<span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="n">t</span> <span class="n">dielectric_dfpt</span> <span class="o">-</span><span class="n">pd</span> <span class="o">../</span><span class="n">structure_opt</span>
</pre></div>
</div>
<p>The additional <code class="code docutils literal notranslate"><span class="pre">user_incar_settings</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">uis</span></code>) in the <code class="code docutils literal notranslate"><span class="pre">dos</span></code> directory
are used to generate volumetric data for the electrostatic potential and all-electron charge density.</p>
<p><code class="code docutils literal notranslate"><span class="pre">vise</span></code> also provides plotting utilities for both the band structure (BS) and density of states (DOS).
See the <a class="reference external" href="https://kumagai-group.github.io/vise/">vise documentation</a> for details.</p>
</section>
<section id="gathering-unit-cell-information-for-point-defect-calculations">
<h2>3. Gathering unit cell information for point-defect calculations<a class="headerlink" href="#gathering-unit-cell-information-for-point-defect-calculations" title="Link to this heading">¶</a></h2>
<p>We next collect the bulk information,
namely the band edges and electronic and ionic dielectric tensors
using the <code class="code docutils literal notranslate"><span class="pre">unitcell</span></code> (= <code class="code docutils literal notranslate"><span class="pre">u</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">u</span> <span class="o">-</span><span class="n">vb</span> <span class="n">band</span><span class="o">/</span><span class="n">vasprun</span><span class="o">-</span><span class="n">finish</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">ob</span> <span class="n">band</span><span class="o">/</span><span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">odc</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">odi</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">n</span> <span class="n">MgAl2O4</span>
</pre></div>
</div>
<p>Here, the electronic and ionic dielectric constants can be set
with different <code class="code docutils literal notranslate"><span class="pre">OUTCAR</span></code> files.
Then, <code class="code docutils literal notranslate"><span class="pre">unitcell.yaml</span></code> is generated, which will be used for analyzing defect calculations later.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">system</span><span class="p">:</span> <span class="n">MgAl2O4</span>
<span class="n">vbm</span><span class="p">:</span> <span class="mf">4.0183</span>
<span class="n">cbm</span><span class="p">:</span> <span class="mf">9.2376</span>
<span class="n">ele_dielectric_const</span><span class="p">:</span>
<span class="o">-</span> <span class="o">-</span> <span class="mf">3.075988</span>
  <span class="o">-</span> <span class="mf">0.0</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">3.075988</span>
  <span class="o">-</span> <span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">3.075988</span>
<span class="n">ion_dielectric_const</span><span class="p">:</span>
<span class="o">-</span> <span class="o">-</span> <span class="mf">5.042937</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">5.042937</span>
  <span class="o">-</span> <span class="mf">0.0</span>
<span class="o">-</span> <span class="o">-</span> <span class="o">-</span><span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">0.0</span>
  <span class="o">-</span> <span class="mf">5.042937</span>
</pre></div>
</div>
<p>Of course, the users can also create it by hand.</p>
</section>
<section id="calculation-of-competing-phases">
<h2>4. Calculation of competing phases<a class="headerlink" href="#calculation-of-competing-phases" title="Link to this heading">¶</a></h2>
<p>When a defect is introduced, atoms are exchanged with hypothetical atomic
reservoirs within a thermodynamic framework.
To calculate the free energy of defect formation, often approximated
by the defect formation energy, we need to determine the chemical potentials
of the atoms involved in the defect.
Typically, these chemical potentials are chosen under the condition
where the host material coexists with its competing phases,
as determined from a chemical potential diagram (CPD).</p>
<p>To set up this process, we create directories under <code class="code docutils literal notranslate"><span class="pre">cpd/</span></code>.
We retrieve <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> files of stable or slightly unstable competing phases
from the <a class="reference external" href="https://materialsproject.org">Materials Project database (MPD)</a>.
This requires an MP API key, as described earlier.</p>
<p>For example, to obtain competing phases for MgAl2O4
with energies above the convex hull less than 0.5 meV/atom, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">mp</span> <span class="o">-</span><span class="n">e</span> <span class="n">Mg</span> <span class="n">Al</span> <span class="n">O</span> <span class="o">--</span><span class="n">e_above_hull</span> <span class="mf">0.0005</span>
</pre></div>
</div>
<p>This command generates directories like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Al2O3_mp</span><span class="o">-</span><span class="mi">1143</span><span class="o">/</span>  <span class="n">Al_mp</span><span class="o">-</span><span class="mi">134</span><span class="o">/</span>  <span class="n">Mg149Al_mp</span><span class="o">-</span><span class="mi">1185596</span><span class="o">/</span>  <span class="n">Mg17Al12_mp</span><span class="o">-</span><span class="mi">2151</span><span class="o">/</span>
<span class="n">MgAl2O4_mp</span><span class="o">-</span><span class="mi">3536</span><span class="o">/</span>  <span class="n">MgAl2_mp</span><span class="o">-</span><span class="mi">1094116</span><span class="o">/</span>  <span class="n">MgO_mp</span><span class="o">-</span><span class="mi">1265</span><span class="o">/</span>  <span class="n">Mg_mp</span><span class="o">-</span><span class="mi">1056702</span><span class="o">/</span>  <span class="n">mol_O2</span><span class="o">/</span>
</pre></div>
</div>
<p>To reduce computational time in this tutorial, we remove <code class="code docutils literal notranslate"><span class="pre">Mg149Al_mp-1185596/</span></code>.</p>
<p>Each directory contains a <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code> file and a <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code> file.
The <code class="code docutils literal notranslate"><span class="pre">prior_info.yaml</span></code> file includes information retrieved from the MPD
that is useful for setting VASP calculation conditions via <code class="code docutils literal notranslate"><span class="pre">vise</span></code>.</p>
<p>For example, <code class="code docutils literal notranslate"><span class="pre">Mg_mp-1056702/prior_info.yaml</span></code> contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">band_gap</span><span class="p">:</span> <span class="mf">0.0</span>
<span class="n">data_source</span><span class="p">:</span> <span class="n">mp</span><span class="o">-</span><span class="mi">1056702</span>
<span class="n">total_magnetization</span><span class="p">:</span> <span class="mf">0.0007357</span>
</pre></div>
</div>
<p>indicating that Mg is a non-magnetic metal.
<code class="code docutils literal notranslate"><span class="pre">vise</span></code> uses this file to determine the k-point density in <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code>
and whether spin polarization is needed via the <code class="code docutils literal notranslate"><span class="pre">ISPIN</span></code> tag in <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>.
If any value is clearly incorrect, the user can modify it manually.</p>
<p>The molecules O<sub>2</sub>, H<sub>2</sub>, N<sub>2</sub>, NH<sub>3</sub>, and NO<sub>2</sub>
are not retrieved from MPD but are instead generated by <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>,
since MPD often treats them as solids, which is unsuitable for defect calculations.</p>
<p>We then generate <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">POTCAR</span></code>, and <code class="code docutils literal notranslate"><span class="pre">KPOINTS</span></code> files for these systems.
A <strong>common cutoff energy</strong>, <code class="code docutils literal notranslate"><span class="pre">ENCUT</span></code>, is needed</p>
</section>
<section id="construction-of-a-supercell-and-defect-species">
<h2>5. Construction of a supercell and defect species<a class="headerlink" href="#construction-of-a-supercell-and-defect-species" title="Link to this heading">¶</a></h2>
<p>We have finished the calculations for the unit cell and the CPD,
and are now ready to proceed with point-defect calculations.
First, create the <code class="code docutils literal notranslate"><span class="pre">defect/</span></code> directory.</p>
<p>Next, we generate files related to the supercell and defect species
using the <code class="code docutils literal notranslate"><span class="pre">supercell</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">s</span></code>)
and <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">ds</span></code>) subcommands.</p>
<p><code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> recommends using a nearly isotropic (and, if possible, cubic-like) supercell
with a moderate number of atoms.
The following command creates a <code class="code docutils literal notranslate"><span class="pre">SPOSCAR</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">CONTCAR</span><span class="o">-</span><span class="n">finish</span>
</pre></div>
</div>
<p>If the input structure is not a standardized primitive cell,
a <code class="code docutils literal notranslate"><span class="pre">NotPrimitiveError</span></code> will be raised.</p>
<p>Currently, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> constructs the supercell by expanding the <em>conventional</em> unit cell.
In principle, it is possible to construct supercells with lattice angles
that differ from those of the conventional cell—
for example, one could make a supercell with mutually orthogonal a-, b-, and c-axes for hexagonal systems.</p>
<p>However, this is generally discouraged, because such modifications break the original symmetry,
which can reduce the accuracy of point-defect calculations
and make symmetry analysis at the defect site more difficult.
Therefore, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> expands the lattice vectors along their original directions by default.</p>
<p>One exception is the tetragonal system,
where rotated supercells (e.g., rotated by 45 degrees in the basal plane)
can preserve the original symmetry and are therefore acceptable.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, users can also specify the supercell transformation matrix. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">CONTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">--</span><span class="n">matrix</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This matrix is applied to the conventional unit cell.</p>
<p>Note again that using an anisotropic supercell may change the symmetry of the structure,
which can result in incorrect symmetry analysis in subsequent steps.</p>
<p>To view the conventional unit cell, use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">si</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">CONTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">c</span>
</pre></div>
</div>
<p>Refer to the help message for more options and details.</p>
<p>Since JSON files are generally less human-readable than YAML files,
<code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> provides the <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command to extract and display
human-readable information from JSON files. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_print</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>This prints a summary of the <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> file as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">Fd</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
<span class="n">Transformation</span> <span class="n">matrix</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Cell</span> <span class="n">multiplicity</span><span class="p">:</span> <span class="mi">4</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Mg1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">b</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
         <span class="n">Cutoff</span> <span class="n">radius</span><span class="p">:</span> <span class="mf">2.528</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.94</span><span class="p">,</span> <span class="mf">1.94</span><span class="p">,</span> <span class="mf">1.94</span><span class="p">,</span> <span class="mf">1.94</span><span class="p">]}</span>
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">0..7</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.2500000</span>  <span class="mf">0.2500000</span>  <span class="mf">0.2500000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.31</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">2</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Al1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">.-</span><span class="mi">3</span><span class="n">m</span>
         <span class="n">Cutoff</span> <span class="n">radius</span><span class="p">:</span> <span class="mf">2.5</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.92</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">]}</span>
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">8..23</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.6250000</span>  <span class="mf">0.3750000</span>  <span class="mf">0.3750000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.61</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">3</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">O1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">e</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="mf">.3</span><span class="n">m</span>
         <span class="n">Cutoff</span> <span class="n">radius</span><span class="p">:</span> <span class="mf">2.5</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.94</span><span class="p">],</span> <span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.92</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">,</span> <span class="mf">1.92</span><span class="p">]}</span>
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">24..55</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.8614957</span>  <span class="mf">0.8614957</span>  <span class="mf">0.8614957</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">3.44</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>
</pre></div>
</div>
<p>Using the <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">ds</span></code>) subcommand,
we can generate the <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> file.
An example of <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> for MgAl2O4 is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Al_Mg1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">Al_O1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">Mg_Al1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">O_Al1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">Va_Al1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">Va_Mg1</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">Va_O1</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>This file lists the combinations of defect species and their charge states.
It can be edited manually if needed, or modified using the <code class="code docutils literal notranslate"><span class="pre">--keywords</span></code> option.</p>
<p>To add dopants, for example Ca, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">d</span> <span class="n">Ca</span>
</pre></div>
</div>
<p>Some tips related to <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> and <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code> are provided below:</p>
<ol class="arabic">
<li><p><strong>Antisite and substitutional defects</strong> are determined based on the difference in
electronegativity between the replacing and replaced atoms.
The default threshold for the maximum allowed difference is defined in
<a class="reference external" href="https://github.com/kumagai-group/pydefect/blob/master/pydefect/defaults.py">defaults.py</a>,
but it can be changed via <code class="code docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>.
Since <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> uses <code class="code docutils literal notranslate"><span class="pre">DefaultsBase</span></code> from <code class="code docutils literal notranslate"><span class="pre">vise</span></code>,
the configuration rules follow those in
<a class="reference external" href="https://kumagai-group.github.io/vise/tutorial_vise_yaml.html">vise.yaml</a>
(with different keywords).</p></li>
<li><p><strong>Oxidation states</strong> determine the possible defect charge states.
For example, a vacancy of Sn<sup>2+</sup> may have charge states of 0, -1, or -2,
while Sn<sup>4+</sup> may have 0 through -4.
For antisite and substitutional defects,
<code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> considers all possible vacancy and interstitial combinations.
For example, Sn<sup>2+</sup> on an S<sup>2-</sup> site may yield charge states
of 0, +1, +2, +3, and +4.</p>
<p>Oxidation states are automatically inferred using the <code class="code docutils literal notranslate"><span class="pre">oxi_state_guesses</span></code>
method of the <code class="code docutils literal notranslate"><span class="pre">Composition</span></code> class in <code class="code docutils literal notranslate"><span class="pre">pymatgen</span></code>.
However, users may also set them manually. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">--</span><span class="n">oxi_states</span> <span class="n">Mg</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Note that the recommended charge states may sometimes miss important cases.
For example, Zn vacancies in ZnO are known to exhibit a +1 charge state
due to the formation of polarons at neighboring O sites.
See <a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.95.094105">Frodason et al., Phys. Rev. B (2017)</a>.
Such cases must be added manually by the user.</p>
</li>
<li><p>By default, atomic positions near the defect are perturbed
to lower the symmetry to P1. While this can help stabilize defect configurations,
it also increases the number of irreducible k-points.
To suppress this, set <code class="code docutils literal notranslate"><span class="pre">displace_distance</span></code> to 0 in <code class="code docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>.</p></li>
<li><p>To restrict calculations to specific defect types,
such as oxygen vacancies only, use the <code class="code docutils literal notranslate"><span class="pre">-k</span></code> option with a Python regular expression.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">k</span> <span class="s2">&quot;Va_O[0-9]?_[0-9]+&quot;</span>
</pre></div>
</div>
<p>This creates the following directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="o">/</span>  <span class="n">Va_O1_0</span><span class="o">/</span>  <span class="n">Va_O1_1</span><span class="o">/</span>  <span class="n">Va_O1_2</span><span class="o">/</span>
</pre></div>
</div>
<p>For information on regular expressions, see the
<a class="reference external" href="https://docs.python.org/3/library/re.html">Python re module documentation</a>.</p>
</li>
</ol>
</section>
<section id="decision-of-interstitial-sites">
<h2>6. Decision of interstitial sites<a class="headerlink" href="#decision-of-interstitial-sites" title="Link to this heading">¶</a></h2>
<p>In addition to vacancies and substitutional defects, interstitials may also be important.
While most people identify interstitial sites by visually inspecting the host crystal structure,
there are some methods that attempt to systematically predict them.</p>
<p>However, identifying the most likely interstitial sites is generally difficult,
as it depends strongly on the specific combination of the host and the inserted elements.</p>
<p>For example, the largest vacant space is often a favorable interstitial site
for positively charged, closed-shell cations (e.g., Mg<sup>2+</sup>, Al<sup>3+</sup>),
which tend not to form strong bonds with neighboring atoms.</p>
<p>In contrast, a proton (H<sup>+</sup>) tends to prefer positions near O<sup>2-</sup> or N<sup>3-</sup>
to form strong O–H or N–H bonds.
Conversely, a hydride ion (H<sup>-</sup>) is expected to occupy very different sites.</p>
<p>Therefore, careful consideration is required when selecting interstitial positions.</p>
<p><code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> includes a utility to assist in identifying interstitial sites
based on volumetric data, such as the all-electron charge density of the unit cell.
This feature uses the <code class="code docutils literal notranslate"><span class="pre">ChargeDensityAnalyzer</span></code> class from <code class="code docutils literal notranslate"><span class="pre">pymatgen</span></code>.</p>
<p>To use it, you need to generate volumetric data such as <code class="code docutils literal notranslate"><span class="pre">AECCAR</span></code> and <code class="code docutils literal notranslate"><span class="pre">LOCPOT</span></code>
based on the standardized primitive cell.
This step has already been performed during the DOS calculation in this tutorial.</p>
<p>Note that it is generally inappropriate to use band structure calculation outputs
for this purpose, since the cell may not match the standardized primitive cell.</p>
<p>After completing the VASP calculation, run the following command in the directory
containing <code class="code docutils literal notranslate"><span class="pre">AECCAR{0,2}</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">le</span> <span class="o">-</span><span class="n">v</span> <span class="n">AECCAR</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span> <span class="o">-</span><span class="n">i</span> <span class="n">all_electron_charge</span>
</pre></div>
</div>
<p>This will print local minima in the charge density as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">a</span>      <span class="n">b</span>      <span class="n">c</span>      <span class="n">value</span>  <span class="n">ave_value</span>
<span class="mi">0</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>   <span class="mf">3.387930</span>   <span class="mf">0.029844</span>
<span class="mi">1</span>  <span class="mf">0.625</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>   <span class="mf">3.383668</span>   <span class="mf">0.029845</span>
<span class="mi">2</span>  <span class="mf">0.125</span>  <span class="mf">0.625</span>  <span class="mf">0.125</span>   <span class="mf">3.383668</span>   <span class="mf">0.029845</span>
<span class="mi">3</span>  <span class="mf">0.125</span>  <span class="mf">0.125</span>  <span class="mf">0.625</span>   <span class="mf">3.383445</span>   <span class="mf">0.029845</span>
<span class="mi">4</span>  <span class="mf">0.500</span>  <span class="mf">0.500</span>  <span class="mf">0.500</span>  <span class="mf">16.501119</span>   <span class="mf">0.155178</span>
<span class="mi">5</span>  <span class="mf">0.750</span>  <span class="mf">0.750</span>  <span class="mf">0.750</span>  <span class="mf">16.501119</span>   <span class="mf">0.155178</span>
</pre></div>
</div>
<p>More details are stored in <code class="code docutils literal notranslate"><span class="pre">volumetric_data_local_extrema.json</span></code>,
which can be viewed using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_print</span> <span class="n">volumetric_data_local_extrema</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">info</span><span class="p">:</span> <span class="n">all_electron_charge</span>
<span class="n">min_or_max</span><span class="p">:</span> <span class="nb">min</span>
<span class="n">extrema_points</span><span class="p">:</span>
<span class="c1">#  site_sym  coordination                                                     frac_coords               quantity</span>
<span class="mi">1</span>  <span class="o">-</span><span class="mi">3</span><span class="n">m</span>       <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">]}</span>  <span class="p">(</span> <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">)</span>  <span class="mf">0.03</span>
<span class="mi">2</span>  <span class="o">-</span><span class="mi">43</span><span class="n">m</span>      <span class="p">{</span><span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">]}</span>  <span class="p">(</span> <span class="mf">0.500</span><span class="p">,</span>  <span class="mf">0.500</span><span class="p">,</span>  <span class="mf">0.500</span><span class="p">)</span>  <span class="mf">0.16</span>
</pre></div>
</div>
<p>Keep in mind that the identified local minima may not always be suitable
for all interstitials. Users should understand the limitations of this method.</p>
<p>To add interstitial sites #1 and #2, use the
<code class="code docutils literal notranslate"><span class="pre">add_interstitials_from_local_extrema</span></code> (abbreviated <code class="code docutils literal notranslate"><span class="pre">ai</span></code>) subcommand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_util</span> <span class="n">ai</span> <span class="o">--</span><span class="n">local_extrema</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">dos</span><span class="o">/</span><span class="n">volumetric_data_local_extrema</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">i</span> <span class="mi">1</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The selected interstitial sites are added to the <code class="code docutils literal notranslate"><span class="pre">supercell_info.json</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">--</span> <span class="n">interstitials</span>
<span class="c1">#1</span>
                  <span class="n">Info</span><span class="p">:</span> <span class="n">all_electron_charge</span> <span class="c1">#1</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>  <span class="mf">0.1250000</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Mg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">]}</span>

<span class="c1">#2</span>
                  <span class="n">Info</span><span class="p">:</span> <span class="n">all_electron_charge</span> <span class="c1">#2</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">]}</span>
</pre></div>
</div>
<p>To remove (pop) an interstitial site (e.g., site #1), use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pi</span> <span class="o">-</span><span class="n">i</span> <span class="mi">1</span> <span class="o">-</span><span class="n">s</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Then, the first site is removed, and only the second remains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">--</span> <span class="n">interstitials</span>
<span class="c1">#1</span>
                  <span class="n">Info</span><span class="p">:</span> <span class="n">all_electron_charge</span> <span class="c1">#2</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>  <span class="mf">0.5000000</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Al&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">],</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">,</span> <span class="mf">1.57</span><span class="p">]}</span>
</pre></div>
</div>
<p>To incorporate the added interstitial sites into <code class="code docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>,
run the <code class="code docutils literal notranslate"><span class="pre">defect_set</span></code> subcommand again.</p>
</section>
<section id="creation-of-defect-calculation-directories">
<h2>7. Creation of defect calculation directories<a class="headerlink" href="#creation-of-defect-calculation-directories" title="Link to this heading">¶</a></h2>
<p>Next, we create directories for the point-defect calculations
using the <code class="code docutils literal notranslate"><span class="pre">defect_entries</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">de</span></code>) subcommand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">de</span>
</pre></div>
</div>
<p>This command creates directories for each defect, including <code class="code docutils literal notranslate"><span class="pre">perfect/</span></code>.</p>
<p>If you run the same command again, you will see output like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="p">:</span> <span class="n">perfect</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">O_i1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Mg_i1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Mg_i1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_3</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Mg_i1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_O1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">3</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_O1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_O1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">O_i1_</span><span class="o">-</span><span class="mi">2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">O_i1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Mg1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Al_i1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Va_Al1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
</pre></div>
</div>
<p>No new directories are created in this case.
This fail-safe mechanism prevents accidental overwriting or deletion
of existing directories and calculated results.</p>
<p>If you want to recreate the directories, you must remove the existing ones manually.</p>
<p>Each defect directory contains a <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file,
which holds information about the point defect,
prior to running first-principles calculations.</p>
<p>To inspect this file, use the <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_print</span> <span class="n">defect_entry</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">--</span> <span class="n">defect</span> <span class="n">entry</span> <span class="n">info</span>
<span class="n">name</span><span class="p">:</span> <span class="n">Va_O1_0</span>
<span class="n">site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="mf">.3</span><span class="n">m</span>
<span class="n">defect</span> <span class="n">center</span><span class="p">:</span> <span class="p">(</span> <span class="mf">0.861</span><span class="p">,</span>  <span class="mf">0.861</span><span class="p">,</span>  <span class="mf">0.861</span><span class="p">)</span>
<span class="n">perturbed</span> <span class="n">sites</span><span class="p">:</span>
<span class="n">elem</span> <span class="n">dist</span>   <span class="n">initial_coords</span>             <span class="n">perturbed_coords</span>         <span class="n">displacement</span>
  <span class="n">Al</span> <span class="mf">1.92</span> <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.637</span><span class="p">,</span>  <span class="mf">0.885</span><span class="p">,</span>  <span class="mf">0.864</span><span class="p">)</span>    <span class="mf">0.15</span>
  <span class="n">Al</span> <span class="mf">1.92</span> <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.879</span><span class="p">,</span>  <span class="mf">0.622</span><span class="p">,</span>  <span class="mf">0.884</span><span class="p">)</span>    <span class="mf">0.09</span>
  <span class="n">Al</span> <span class="mf">1.92</span> <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.625</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.624</span><span class="p">)</span>    <span class="mf">0.01</span>
  <span class="n">Mg</span> <span class="mf">1.94</span> <span class="p">(</span> <span class="mf">1.000</span><span class="p">,</span>  <span class="mf">1.000</span><span class="p">,</span>  <span class="mf">1.000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="mf">0.004</span><span class="p">,</span>  <span class="mf">0.001</span><span class="p">,</span>  <span class="mf">0.006</span><span class="p">)</span>    <span class="mf">0.06</span>
</pre></div>
</div>
</section>
<section id="generation-of-defect-entry-json">
<h2>8. Generation of defect_entry.json<a class="headerlink" href="#generation-of-defect-entry-json" title="Link to this heading">¶</a></h2>
<p>Sometimes, users may need to treat complex defects.
For example, O<sub>2</sub> molecules can act as anions in MgO<sub>2</sub>,
where vacancies of O<sub>2</sub> molecules may be sufficiently stable.
Other important cases include methylammonium lead halides (MAPI),
where methylammonium ions act as singly charged cations (CH<sub>3</sub>NH<sub>3</sub><sup>+</sup>),
and DX centers, where anion vacancies and interstitial cations coexist.</p>
<p>In such cases, users must prepare the input files and run VASP calculations manually.
However, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> requires the <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file for post-processing,
which is not straightforward to create manually.</p>
<p>To assist with this, <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> provides a subcommand
that generates <code class="code docutils literal notranslate"><span class="pre">defect_entry.json</span></code> by analyzing the structural difference
between the defect structure and the perfect supercell.
The defect charge is determined based on the <code class="code docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="code docutils literal notranslate"><span class="pre">POSCAR</span></code>, and <code class="code docutils literal notranslate"><span class="pre">POTCAR</span></code> files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp_util</span> <span class="n">de</span> <span class="o">-</span><span class="n">d</span> <span class="o">.</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">perfect</span><span class="o">/</span><span class="n">POSCAR</span> <span class="o">-</span><span class="n">n</span> <span class="n">complex_defect</span>
</pre></div>
</div>
<p>This subcommand is also useful when applying <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>
to analyze previously completed defect calculations.</p>
</section>
<section id="parsing-supercell-calculation-results">
<h2>9. Parsing supercell calculation results<a class="headerlink" href="#parsing-supercell-calculation-results" title="Link to this heading">¶</a></h2>
<p>Next, run the VASP calculations for each point defect.
To generate the VASP input files, use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in */; do cd $i; vise vs -t defect; cd ../; done
</pre></div>
</div>
<p>Be sure to include the <code class="code docutils literal notranslate"><span class="pre">-t</span> <span class="pre">defect</span></code> option
to generate input files suitable for defect calculations.</p>
<p>When performing VASP calculations on large supercells with only the Gamma point sampled,
we recommend using the Gamma-only version of VASP for efficiency.</p>
<p>After completing the calculations,
you can generate the <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code> file,
which contains the key results from the first-principles calculations
relevant to defect properties.</p>
<p>Use the <code class="code docutils literal notranslate"><span class="pre">calc_results</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">cr</span></code>) subcommand
to generate <code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code> in all defect directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">cr</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="n">perfect</span>
</pre></div>
</div>
<p>If any of the calculations are still in progress,
their directories will be automatically skipped during parsing.</p>
</section>
<section id="corrections-of-defect-formation-energies-in-finite-size-supercells">
<h2>10. Corrections of defect formation energies in finite-size supercells<a class="headerlink" href="#corrections-of-defect-formation-energies-in-finite-size-supercells" title="Link to this heading">¶</a></h2>
<p>When using supercells under periodic boundary conditions,
the total energies of <strong>charged defects</strong> are not correctly estimated
due to interactions between the defect, its periodic images, and the compensating background charge.</p>
<p>Therefore, it is necessary to apply finite-size corrections to the total energies
to approximate the dilute limit more accurately.</p>
<p>These corrections can be performed using the <code class="code docutils literal notranslate"><span class="pre">extended_fnv_correction</span></code>
(abbreviated as <code class="code docutils literal notranslate"><span class="pre">efnv</span></code>) subcommand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">efnv</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>This command requires the static dielectric constants
and the atomic site potentials of the perfect supercell.
Thus, you must provide the paths to both <code class="code docutils literal notranslate"><span class="pre">unitcell.yaml</span></code> and
<code class="code docutils literal notranslate"><span class="pre">calc_results.json</span></code> in the <code class="code docutils literal notranslate"><span class="pre">perfect/</span></code> directory.</p>
<p>Note that the correction process may take some time to complete.</p>
<p>The correction in <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> is based on the
extended Freysoldt–Neugebauer–Van de Walle (eFNV) method.</p>
<p>If you use this correction scheme, please cite the following references:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.102.016402">C. Freysoldt, J. Neugebauer, and C. Van de Walle, Fully Ab Initio Finite-Size Corrections for Charged-Defect Supercell Calculations, Phys. Rev. Lett., 102, 016402 (2009).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai* and F. Oba, Electrostatics-based finite-size corrections for first-principles point defect calculations, Phys. Rev. B, 89, 195205 (2014).</a></p></li>
</ul>
<p>This command generates a file named <code class="code docutils literal notranslate"><span class="pre">correction.pdf</span></code>,
which includes the defect-induced and point-charge potentials
as well as their difference at atomic sites. For example:</p>
<img alt="_images/correction.png" src="_images/correction.png" />
<p>The height of the horizontal line indicates the averaged potential difference
between the point-charge potential and the defect-induced potential—
specifically, the potential in the defective supercell minus that in the perfect one.</p>
<p>The length of the line indicates the spatial averaging range.
For more details, refer to the above publication by Kumagai and Oba (2014).</p>
<p>It is <strong>strongly recommended</strong> to visually inspect all <code class="code docutils literal notranslate"><span class="pre">correction.pdf</span></code> files
for the calculated defects to avoid mistakes in applying corrections.</p>
</section>
<section id="check-defect-structures">
<h2>11. Check defect structures<a class="headerlink" href="#check-defect-structures" title="Link to this heading">¶</a></h2>
<p>We analyze the local structures around defects
using the <code class="code docutils literal notranslate"><span class="pre">defect_structure_info</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">dsi</span></code>) subcommand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">dsi</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>This generates <code class="code docutils literal notranslate"><span class="pre">defect_structure_info.json</span></code> files for each defect directory.
You can view their contents using the <code class="code docutils literal notranslate"><span class="pre">pydefect_print</span></code> command. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">--</span> <span class="n">defect</span> <span class="n">structure</span> <span class="n">info</span>
<span class="n">Defect</span> <span class="nb">type</span><span class="p">:</span> <span class="n">vacancy</span>
<span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="p">(</span><span class="n">same</span><span class="p">)</span>
<span class="n">Has</span> <span class="n">same</span> <span class="n">configuration</span> <span class="kn">from</span><span class="w"> </span><span class="nn">initial</span> <span class="n">structure</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">Drift</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">0.022</span>
<span class="n">Defect</span> <span class="n">center</span><span class="p">:</span> <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">,</span>  <span class="mf">0.372</span><span class="p">)</span>
<span class="n">Removed</span> <span class="n">atoms</span><span class="p">:</span>
<span class="mi">8</span>  <span class="n">Al</span>  <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">)</span>

<span class="n">Neighbor</span> <span class="nb">max</span> <span class="n">distance</span> <span class="mf">2.472</span>
<span class="n">Displacements</span>
<span class="n">Elem</span>  <span class="n">Dist</span>  <span class="n">Displace</span>  <span class="n">Angle</span>  <span class="n">Index</span>  <span class="n">Initial</span> <span class="n">site</span>                  <span class="n">Final</span> <span class="n">site</span>                <span class="n">Neighbor</span>
<span class="n">O</span>     <span class="mf">1.9</span>   <span class="mf">0.26</span>      <span class="mi">160</span>    <span class="mi">46</span>     <span class="p">(</span> <span class="mf">0.639</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">,</span>  <span class="mf">0.139</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.647</span><span class="p">,</span>  <span class="mf">0.353</span><span class="p">,</span>  <span class="mf">0.108</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.92</span>  <span class="mf">0.26</span>      <span class="mi">160</span>    <span class="mi">42</span>     <span class="p">(</span> <span class="mf">0.639</span><span class="p">,</span>  <span class="mf">0.139</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.647</span><span class="p">,</span>  <span class="mf">0.110</span><span class="p">,</span>  <span class="mf">0.351</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.92</span>  <span class="mf">0.26</span>      <span class="mi">160</span>    <span class="mi">26</span>     <span class="p">(</span> <span class="mf">0.861</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">,</span>  <span class="mf">0.361</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.890</span><span class="p">,</span>  <span class="mf">0.353</span><span class="p">,</span>  <span class="mf">0.351</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.92</span>  <span class="mf">0.24</span>      <span class="mi">170</span>    <span class="mi">47</span>     <span class="p">(</span> <span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.360</span><span class="p">,</span>  <span class="mf">0.396</span><span class="p">,</span>  <span class="mf">0.394</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.93</span>  <span class="mf">0.24</span>      <span class="mi">170</span>    <span class="mi">31</span>     <span class="p">(</span> <span class="mf">0.611</span><span class="p">,</span>  <span class="mf">0.611</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.604</span><span class="p">,</span>  <span class="mf">0.639</span><span class="p">,</span>  <span class="mf">0.394</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">O</span>     <span class="mf">1.94</span>  <span class="mf">0.23</span>      <span class="mi">160</span>    <span class="mi">35</span>     <span class="p">(</span> <span class="mf">0.611</span><span class="p">,</span>  <span class="mf">0.389</span><span class="p">,</span>  <span class="mf">0.611</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.604</span><span class="p">,</span>  <span class="mf">0.396</span><span class="p">,</span>  <span class="mf">0.637</span><span class="p">)</span>  <span class="n">T</span>
<span class="n">Al</span>    <span class="mf">2.85</span>  <span class="mf">0.03</span>      <span class="mi">30</span>     <span class="mi">14</span>     <span class="p">(</span> <span class="mf">0.625</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.627</span><span class="p">,</span>  <span class="mf">0.128</span><span class="p">,</span>  <span class="mf">0.127</span><span class="p">)</span>
<span class="n">Al</span>    <span class="mf">2.85</span>  <span class="mf">0.03</span>      <span class="mi">30</span>     <span class="mi">21</span>     <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.872</span><span class="p">,</span>  <span class="mf">0.373</span><span class="p">,</span>  <span class="mf">0.127</span><span class="p">)</span>
<span class="n">Al</span>    <span class="mf">2.87</span>  <span class="mf">0.05</span>      <span class="mi">40</span>     <span class="mi">16</span>     <span class="p">(</span> <span class="mf">0.875</span><span class="p">,</span>  <span class="mf">0.125</span><span class="p">,</span>  <span class="mf">0.375</span><span class="p">)</span>  <span class="o">-&gt;</span>  <span class="p">(</span> <span class="mf">0.872</span><span class="p">,</span>  <span class="mf">0.128</span><span class="p">,</span>  <span class="mf">0.372</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also generate VESTA files to visualize the defect structures
using the <code class="code docutils literal notranslate"><span class="pre">defect_vesta_file</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">dvf</span></code>) subcommand
in <code class="code docutils literal notranslate"><span class="pre">pydefect_util</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_util</span> <span class="n">dvf</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>This creates <code class="code docutils literal notranslate"><span class="pre">defect.vesta</span></code> files in each defect directory.</p>
</section>
<section id="check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations">
<h2>12. Check defect eigenvalues and band-edge states in supercell calculations<a class="headerlink" href="#check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations" title="Link to this heading">¶</a></h2>
<p><strong>Note: This section is optional.</strong></p>
<p>In general, point defects can be classified into three categories:</p>
<p>(1) <strong>Defects with deep localized states</strong> inside the band gap.
These defects are often detrimental to device performance because they can trap carriers.
They may also act as color centers, such as vacancies in NaCl.
Thus, it is important to identify the location and character of such defect states.</p>
<p>(2) <strong>Defects with hydrogenic carrier states</strong>, or <strong>perturbed host states (PHS)</strong>.
Here, the carriers are weakly bound to the charged defect center near the band edges.
Examples include B-on-Si (p-type) and P-on-Si (n-type) substitutional dopants in silicon.
These defects are typically not harmful to devices but may introduce carriers
or eliminate counter carriers.
The wavefunctions of PHS can extend over millions of atoms,
so first-principles calculations of their thermodynamic transition levels require very large supercells,
which are computationally infeasible.
Thus, their charge transition levels are often not calculated directly
but assumed to lie near the band edges based on qualitative assessments.</p>
<p>(3) <strong>Defects without any states inside the band gap or near the band edges</strong>.
These defects have little impact on electronic properties
as long as their concentrations remain low.</p>
<p>For examples of each case, see our publications:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://link.aps.org/pdf/10.1103/PhysRevB.90.125202">Y. Kumagai et al., Phys. Rev. B 90, 125202 (2014).</a></p></li>
<li><p><a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevApplied.6.014009">Y. Kumagai et al., Phys. Rev. Applied 6, 014009 (2016).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.8.014015">Y. Kumagai et al., Phys. Rev. Applied 8, 014015 (2017).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.9.034019">Y. Kumagai et al., Phys. Rev. Applied 9, 034019 (2018).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.10.011001">N. Tsunoda et al., Phys. Rev. Applied 10, 011001 (2018).</a></p></li>
</ul>
<p>To distinguish among these types, one must examine the defect energy levels and wavefunctions
to determine whether PHS or localized states are present.</p>
<p><code class="code docutils literal notranslate"><span class="pre">pydefect</span></code> provides tools to analyze eigenvalues and band-edge states as follows:</p>
<p>First, generate <code class="code docutils literal notranslate"><span class="pre">perfect_band_edge_state.json</span></code>
using the <code class="code docutils literal notranslate"><span class="pre">perfect_band_edge_state</span></code> subcommand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">pbes</span> <span class="o">-</span><span class="n">d</span> <span class="n">perfect</span>
</pre></div>
</div>
<p>Then, generate <code class="code docutils literal notranslate"><span class="pre">band_edge_orbital_infos.json</span></code> files
in the defect directories using the <code class="code docutils literal notranslate"><span class="pre">band_edge_orbital_infos</span></code> subcommand
(abbreviated as <code class="code docutils literal notranslate"><span class="pre">beoi</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_vasp</span> <span class="n">beoi</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">pbes</span> <span class="n">perfect</span><span class="o">/</span><span class="n">perfect_band_edge_state</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>This also creates <code class="code docutils literal notranslate"><span class="pre">eigenvalues.pdf</span></code> plots.</p>
<img alt="_images/eigenvalues.png" src="_images/eigenvalues.png" />
<p>These plots show the single-particle levels and their occupations
for spin-up and spin-down channels.
The x-axis corresponds to the fractional coordinates of k-points,
and the y-axis shows the absolute energy.
Each circle represents a state; red, green, and blue denote
occupied, partially occupied (0.2–0.8), and unoccupied levels, respectively.</p>
<p>The two horizontal dashed lines indicate the VBM and CBM of the <strong>perfect</strong> supercell.
Band indices are labeled numerically.</p>
<p>Next, generate <code class="code docutils literal notranslate"><span class="pre">band_edge_states.json</span></code>
using the <code class="code docutils literal notranslate"><span class="pre">band_edge_states</span></code> (abbreviated as <code class="code docutils literal notranslate"><span class="pre">bes</span></code>) subcommand:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">bes</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pbes</span> <span class="n">perfect</span><span class="o">/</span><span class="n">perfect_band_edge_state</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>To examine this file, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect_print</span> <span class="n">band_edge_states</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">--</span> <span class="n">band</span><span class="o">-</span><span class="n">edge</span> <span class="n">states</span> <span class="n">info</span>
<span class="n">Spin</span><span class="o">-</span><span class="n">up</span>
     <span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">OrbDiff</span>  <span class="n">Orbitals</span>                          <span class="n">K</span><span class="o">-</span><span class="n">point</span> <span class="n">coords</span>
<span class="n">VBM</span>  <span class="mi">128</span>    <span class="mf">3.727</span>   <span class="mf">0.33</span>     <span class="mf">1.00</span>        <span class="mf">0.02</span>     <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.76</span>                         <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">CBM</span>  <span class="mi">129</span>    <span class="mf">9.980</span>   <span class="mf">0.06</span>     <span class="mf">0.00</span>        <span class="mf">0.03</span>     <span class="n">Al</span><span class="o">-</span><span class="n">s</span><span class="p">:</span> <span class="mf">0.11</span><span class="p">,</span> <span class="n">O</span><span class="o">-</span><span class="n">s</span><span class="p">:</span> <span class="mf">0.21</span><span class="p">,</span> <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.11</span>  <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">vbm</span> <span class="n">has</span> <span class="n">acceptor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.000</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">cbm</span> <span class="n">has</span> <span class="n">donor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.000</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="o">---</span>
<span class="n">Localized</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">Orbitals</span>

<span class="n">Spin</span><span class="o">-</span><span class="n">down</span>
     <span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">OrbDiff</span>  <span class="n">Orbitals</span>              <span class="n">K</span><span class="o">-</span><span class="n">point</span> <span class="n">coords</span>
<span class="n">VBM</span>  <span class="mi">126</span>    <span class="mf">4.083</span>   <span class="mf">0.67</span>     <span class="mf">0.88</span>        <span class="mf">0.06</span>     <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.72</span>             <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">CBM</span>  <span class="mi">129</span>    <span class="mf">10.010</span>  <span class="mf">0.06</span>     <span class="mf">0.00</span>        <span class="mf">0.01</span>     <span class="n">O</span><span class="o">-</span><span class="n">s</span><span class="p">:</span> <span class="mf">0.21</span><span class="p">,</span> <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">0.11</span>  <span class="p">(</span> <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">,</span>  <span class="mf">0.250</span><span class="p">)</span>
<span class="n">vbm</span> <span class="n">has</span> <span class="n">acceptor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.120</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">cbm</span> <span class="n">has</span> <span class="n">donor</span> <span class="n">phs</span><span class="p">:</span> <span class="kc">False</span> <span class="p">(</span><span class="mf">0.000</span> <span class="n">vs</span><span class="o">.</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="o">---</span>
<span class="n">Localized</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">Index</span>  <span class="n">Energy</span>  <span class="n">P</span><span class="o">-</span><span class="n">ratio</span>  <span class="n">Occupation</span>  <span class="n">Orbitals</span>
<span class="mi">127</span>    <span class="mf">4.277</span>   <span class="mf">0.62</span>     <span class="mf">0.06</span>        <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">2.98</span>
<span class="mi">128</span>    <span class="mf">4.278</span>   <span class="mf">0.62</span>     <span class="mf">0.06</span>        <span class="n">O</span><span class="o">-</span><span class="n">p</span><span class="p">:</span> <span class="mf">2.98</span>
</pre></div>
</div>
<p>The analysis is given for both spin channels.</p>
<p><code class="code docutils literal notranslate"><span class="pre">P-ratio</span></code> is the participation ratio,
which measures how much of the orbital density is localized
on neighboring atoms (as listed in <code class="code docutils literal notranslate"><span class="pre">defect_structure_info.json</span></code>)
relative to the total over the entire cell.</p>
<p>As mentioned, the formation energies of defects with occupied
<code class="code docutils literal notranslate"><span class="pre">donor</span> <span class="pre">phs</span></code> or unoccupied <code class="code docutils literal notranslate"><span class="pre">acceptor</span> <span class="pre">phs</span></code>
should typically be excluded from formation energy diagrams.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">pydefect</span></code>, these classifications are based on the eigenvalues
and the similarity of the wavefunctions to those of the VBM and CBM.
For details, please refer to our upcoming publication.</p>
<p><strong>Note:</strong> Automatic classification of PHS and localized states is not always reliable.
Users are encouraged to visually inspect the band-edge states
and examine band-decomposed charge densities when necessary.</p>
</section>
<section id="plot-defect-formation-energies">
<h2>13. Plot defect formation energies<a class="headerlink" href="#plot-defect-formation-energies" title="Link to this heading">¶</a></h2>
<p>Here, we demonstrate how to plot defect formation energies.</p>
<p>Plotting defect formation energies requires multiple types of information:
the band edges, chemical potentials of the competing phases,
and the total energies of both perfect and defective supercells.</p>
<p>First, use the <code class="code docutils literal notranslate"><span class="pre">defect_energy_infos</span></code> (= <code class="code docutils literal notranslate"><span class="pre">dei</span></code>) sub-command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">dei</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">s</span> <span class="o">../</span><span class="n">cpd</span><span class="o">/</span><span class="n">standard_energies</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>This command generates the <code class="code docutils literal notranslate"><span class="pre">defect_energy_info.yaml</span></code> files within each defect directory.
An example is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">Va_O1</span>
<span class="n">charge</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">formation_energy</span><span class="p">:</span> <span class="mf">6.803585744999999</span>
<span class="n">atom_io</span><span class="p">:</span>
  <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">energy_corrections</span><span class="p">:</span>
  <span class="n">pc</span> <span class="n">term</span><span class="p">:</span> <span class="mf">0.0</span>
  <span class="n">alignment</span> <span class="n">term</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.0</span>
<span class="n">is_shallow</span><span class="p">:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Caveats:
(1) The <code class="code docutils literal notranslate"><span class="pre">formation_energy</span></code> is calculated assuming the chemical potentials
of the elements are at their standard states, and the Fermi level is at 0 eV.
(2) Although two energy corrections are included (<code class="code docutils literal notranslate"><span class="pre">pc</span> <span class="pre">term</span></code> and <code class="code docutils literal notranslate"><span class="pre">alignment</span> <span class="pre">term</span></code>),
you may add custom correction terms if needed.
(3) The <code class="code docutils literal notranslate"><span class="pre">is_shallow</span></code> value will be empty if the previous section (on PHS identification) is skipped.
Here, “shallow” refers to the presence of a perturbed host state (PHS). You may modify
the classification (e.g., shallow/deep) manually if desired.</p>
<p>Next, create the <code class="code docutils literal notranslate"><span class="pre">defect_energy_summary.json</span></code> file using the <code class="code docutils literal notranslate"><span class="pre">defect_energy_summary</span></code> (= <code class="code docutils literal notranslate"><span class="pre">des</span></code>) sub-command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">des</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">pbes</span> <span class="n">perfect</span><span class="o">/</span><span class="n">perfect_band_edge_state</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">t</span> <span class="o">../</span><span class="n">cpd</span><span class="o">/</span><span class="n">target_vertices</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>This sub-command collects information from each <code class="code docutils literal notranslate"><span class="pre">defect_energy_info.yaml</span></code>
file and compiles it into <code class="code docutils literal notranslate"><span class="pre">defect_energy_summary.json</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>title: MgAl₂O₄
rel_chem_pots:
 -A Al: 0.00 Mg: -0.69 O: -5.25
 -B Al: 0.00 Mg: -0.32 O: -5.34
 -C Al: -7.87 Mg: -5.94 O: 0.00
 -D Al: -8.01 Mg: -5.66 O: 0.00
vbm: 0.00, cbm: 5.22, supercell vbm: -0.03, supercell_cbm: 6.14

name    atom_io         charge    energy    correction  is_shallow
------  ------------  --------  --------  ------------  ------------
Al_i1   Al: 1               -1    14.958        -0.049  False
                             0     9.896         0.000  True
                             1     3.376         0.527  False
                             2    -0.872         1.814  True
                             3    -6.994         3.370  False
Mg_i1   Mg: 1                0     8.208         0.000  True
                             1     2.015         0.555  True
                             2    -4.117         1.534  False
O_i1    O: 1                -2     8.122         0.721  False
                            -1     7.055         0.149  False
                             0     4.566         0.000  False
Va_Al1  Al: -1              -3    13.527         3.402  False
                            -2    12.968         1.789  True
                            -1    12.672         0.660  True
                             0    12.595         0.000  True
                             1    12.710        -0.232  True
Va_Mg1  Mg: -1              -2    10.093         1.524  False
                            -1     9.580         0.578  True
                             0     9.311         0.000  False
Va_MgO  O: -1 Mg: -1         0     9.887         0.000  False
Va_O1   O: -1                0     6.804         0.000  False
                             1     3.808         0.166  False
                             2     0.883         0.845  False
</pre></div>
</div>
<p>You can also create a <code class="code docutils literal notranslate"><span class="pre">calc_summary.json</span></code> file using the <code class="code docutils literal notranslate"><span class="pre">calc_summary</span></code> (= <code class="code docutils literal notranslate"><span class="pre">cs</span></code>) sub-command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cs</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>This outputs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="p">:</span><span class="o">---------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">----------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">-----------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">-----------------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">------------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">------------------</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">--------------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span>   <span class="n">name</span>    <span class="o">|</span> <span class="n">Ele</span><span class="o">.</span> <span class="n">conv</span><span class="o">.</span> <span class="o">|</span> <span class="n">Ionic</span> <span class="n">conv</span><span class="o">.</span> <span class="o">|</span> <span class="n">Is</span> <span class="n">energy</span> <span class="n">strange</span> <span class="o">|</span> <span class="n">Same</span> <span class="n">config</span><span class="o">.</span> <span class="o">|</span>    <span class="n">Defect</span> <span class="nb">type</span>     <span class="o">|</span> <span class="n">Symm</span><span class="o">.</span> <span class="n">Relation</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Al_i1_</span><span class="o">-</span><span class="mi">1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Al_i1_3</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Mg_i1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Mg_i1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Mg_i1_2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">O_i1_</span><span class="o">-</span><span class="mi">1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">O_i1_</span><span class="o">-</span><span class="mi">2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span> <span class="n">interstitial_split</span> <span class="o">|</span>    <span class="n">subgroup</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="n">O_i1_0</span>   <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">2</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_</span><span class="o">-</span><span class="mi">3</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Al1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">1</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">2</span> <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_Mg1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Va_MgO_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>    <span class="kc">False</span>     <span class="o">|</span>      <span class="n">unknown</span>       <span class="o">|</span>      <span class="n">same</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="n">Va_O1_0</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Va_O1_1</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
<span class="o">|</span>  <span class="n">Va_O1_2</span>  <span class="o">|</span>     <span class="o">.</span>      <span class="o">|</span>      <span class="o">.</span>      <span class="o">|</span>         <span class="o">.</span>         <span class="o">|</span>      <span class="o">.</span>       <span class="o">|</span>         <span class="o">.</span>          <span class="o">|</span>       <span class="o">.</span>        <span class="o">|</span>
</pre></div>
</div>
<p>Note: this feature is still in beta.</p>
<p>Finally, plot the defect formation energies as a function of the Fermi level
using the <code class="code docutils literal notranslate"><span class="pre">plot_defect_formation_energy</span></code> (= <code class="code docutils literal notranslate"><span class="pre">pe</span></code>) sub-command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pe</span> <span class="o">-</span><span class="n">d</span> <span class="n">defect_energy_summary</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">l</span> <span class="n">A</span>
</pre></div>
</div>
<p>This generates a plot like the following:</p>
<img alt="_images/energy_A.pdf" src="_images/energy_A.pdf" />
<p>To change the chemical potential condition—i.e., select a different vertex from the chemical potential diagram—use the <code class="code docutils literal notranslate"><span class="pre">-l</span></code> option.</p>
</section>
<section id="calculate-the-carrier-and-defect-concentrations">
<h2>14. Calculate the carrier and defect concentrations<a class="headerlink" href="#calculate-the-carrier-and-defect-concentrations" title="Link to this heading">¶</a></h2>
<p>Once we obtain the formation energies of dominant defects,
we can estimate the carrier and defect concentrations can be estimated from the charge neutrality condition.</p>
<p>The equilibrium $epsilon_F$ ,
begin{align}</p>
<blockquote>
<div><p>p-n+sum qC[D^q]=0.
label{eq:charge_neutrality}</p>
</div></blockquote>
<p>end{align}
We describe $ef$ satisfying the condition as $ef^text{CN}$.
Since the left side of Eq.~eqref{eq:charge_neutrality} is monotonically increased as increasing $ef$,
$ef^text{CN}$ is determined numerically.</p>
<p>When the growth temperature exceeds room temperature,
we typically calculate $ef$ at room temperature, assuming
that defect concentrations are quenched from the growth temperature.
Subsequently, the defects are assumed to adopt various charge states
in proportions determined by the Boltzmann distribution.</p>
<p>An example is shown in Fig. xx.
When the</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="concentrations.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Tutorial of how to calculate carrier and defect concentration using pydefect</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020, Yu Kumagai
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Tutorial of pydefect</a><ul>
<li><a class="reference internal" href="#relaxation-of-the-unit-cell">1. Relaxation of the unit cell</a></li>
<li><a class="reference internal" href="#calculation-of-band-dos-and-dielectric-tensor">2. Calculation of band, DOS, and dielectric tensor</a></li>
<li><a class="reference internal" href="#gathering-unit-cell-information-for-point-defect-calculations">3. Gathering unit cell information for point-defect calculations</a></li>
<li><a class="reference internal" href="#calculation-of-competing-phases">4. Calculation of competing phases</a></li>
<li><a class="reference internal" href="#construction-of-a-supercell-and-defect-species">5. Construction of a supercell and defect species</a></li>
<li><a class="reference internal" href="#decision-of-interstitial-sites">6. Decision of interstitial sites</a></li>
<li><a class="reference internal" href="#creation-of-defect-calculation-directories">7. Creation of defect calculation directories</a></li>
<li><a class="reference internal" href="#generation-of-defect-entry-json">8. Generation of defect_entry.json</a></li>
<li><a class="reference internal" href="#parsing-supercell-calculation-results">9. Parsing supercell calculation results</a></li>
<li><a class="reference internal" href="#corrections-of-defect-formation-energies-in-finite-size-supercells">10. Corrections of defect formation energies in finite-size supercells</a></li>
<li><a class="reference internal" href="#check-defect-structures">11. Check defect structures</a></li>
<li><a class="reference internal" href="#check-defect-eigenvalues-and-band-edge-states-in-supercell-calculations">12. Check defect eigenvalues and band-edge states in supercell calculations</a></li>
<li><a class="reference internal" href="#plot-defect-formation-energies">13. Plot defect formation energies</a></li>
<li><a class="reference internal" href="#calculate-the-carrier-and-defect-concentrations">14. Calculate the carrier and defect concentrations</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>